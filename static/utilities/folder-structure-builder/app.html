<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <title>Folder Structure Builder</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {sans: ['Inter', 'system-ui', 'sans-serif']},
          },
        },
      };
    </script>
    <style>
      :root {
        color-scheme: light;
      }
      body {
        font-family: 'Inter', system-ui, sans-serif;
        background: linear-gradient(135deg, #0f172a, #111827);
        color: #0f172a;
        margin: 0;
      }
      .custom-scrollbar::-webkit-scrollbar {
        width: 8px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 8px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: #f8fafc;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const {useEffect, useRef, useState} = React;

      const ICONS = {
        folder: ['M4 4h5l2 3h9a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z'],
        file: [
          'M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z',
          'M14 2v6h6',
        ],
        plus: ['M12 5v14', 'M5 12h14'],
        'trash-2': [
          'M3 6h18',
          'M8 6v12a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6',
          'M10 6V4a2 2 0 0 1 2-2h0a2 2 0 0 1 2 2v2',
          'M10 11v6',
          'M14 11v6',
        ],
        'chevron-right': ['m9 18 6-6-6-6'],
        'chevron-down': ['m6 9 6 6 6-6'],
        download: ['M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4', 'M7 10l5 5 5-5', 'M12 15V3'],
        copy: ['M8 8h10a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V10a2 2 0 0 1 2-2z', 'M16 8V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2'],
        terminal: ['M4 17 10 11 4 5', 'M12 19h8'],
        archive: ['M3 3h18v4H3z', 'M5 7v13a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7', 'M10 12h4'],
        upload: ['M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4', 'M17 8 12 3 7 8', 'M12 3v16'],
        'file-json': [
          'M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z',
          'M14 2v6h6',
          'M10 13v4',
          'M9 17h2',
          'M14 17h1a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1h-1',
          'M18 17v-4',
        ],
        'alert-circle': ['M12 9v4', 'M12 17h.01', 'M22 12A10 10 0 1 1 2 12a10 10 0 0 1 20 0z'],
        save: ['M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z', 'M17 21v-8H7v8', 'M7 3v5h8'],
        'file-archive': [
          'M9 3h6a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z',
          'M9 7h6',
          'M9 11h6',
          'M9 15h6',
        ],
        'file-code': [
          'M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z',
          'M14 2v6h6',
          'M10 13l-2 2 2 2',
          'M14 17l2-2-2-2',
        ],
        check: ['M20 6 9 17l-5-5'],
      };

      const Icon = ({name, size = 16, className = ''}) => {
        const paths = ICONS[name];
        if (!paths) return null;
        return (
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width={size}
            height={size}
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
            className={className}
            aria-hidden="true"
          >
            {Array.isArray(paths) ? paths.map((d, index) => <path key={index} d={d} />) : <path d={paths} />}
          </svg>
        );
      };
      const TreeItem = ({node, depth, onAdd, onDelete, onToggle, selectedId, onSelect}) => {
        const isSelected = selectedId === node.id;
        const indent = {paddingLeft: `${depth * 20 + 8}px`};

        return (
          <div className="select-none">
            <div
              className={`flex items-center p-2 rounded-md cursor-pointer transition-colors border border-transparent ${
                isSelected ? 'bg-indigo-100 border-indigo-300' : 'hover:bg-slate-100'
              }`}
              style={indent}
              onClick={() => onSelect(node)}
            >
              <button
                onClick={(event) => {
                  event.stopPropagation();
                  onToggle(node.id);
                }}
                className={`mr-1 p-1 rounded-full hover:bg-slate-200 ${node.type === 'file' ? 'invisible' : ''}`}
                aria-label={node.isOpen ? 'Collapse' : 'Expand'}
              >
                {node.isOpen ? <Icon name="chevron-down" size={14} /> : <Icon name="chevron-right" size={14} />}
              </button>

              <span className={`mr-2 ${node.type === 'folder' ? 'text-indigo-500' : 'text-slate-500'}`}>
                {node.type === 'folder' ? <Icon name="folder" size={18} /> : <Icon name="file" size={18} />}
              </span>

              <span className="text-sm font-medium text-slate-700 truncate">{node.name}</span>

              {isSelected ? (
                <div className="ml-auto flex gap-1">
                  {node.type === 'folder' ? (
                    <>
                      <button
                        onClick={(event) => {
                          event.stopPropagation();
                          onAdd(node.id, 'folder');
                        }}
                        className="p-1 text-indigo-600 hover:bg-indigo-200 rounded"
                        title="Add folder"
                        aria-label="Add folder"
                      >
                        <Icon name="plus" size={14} />
                      </button>
                      <button
                        onClick={(event) => {
                          event.stopPropagation();
                          onAdd(node.id, 'file');
                        }}
                        className="p-1 text-emerald-600 hover:bg-emerald-200 rounded"
                        title="Add file"
                        aria-label="Add file"
                      >
                        <Icon name="file" size={14} />
                      </button>
                    </>
                  ) : null}
                  {depth > 0 ? (
                    <button
                      onClick={(event) => {
                        event.stopPropagation();
                        onDelete(node.id);
                      }}
                      className="p-1 text-red-500 hover:bg-red-200 rounded"
                      title="Delete"
                      aria-label="Delete"
                    >
                      <Icon name="trash-2" size={14} />
                    </button>
                  ) : null}
                </div>
              ) : null}
            </div>

            {node.type === 'folder' && node.isOpen && node.children ? (
              <div>
                {node.children.map((child) => (
                  <TreeItem
                    key={child.id}
                    node={child}
                    depth={depth + 1}
                    onAdd={onAdd}
                    onDelete={onDelete}
                    onToggle={onToggle}
                    selectedId={selectedId}
                    onSelect={onSelect}
                  />
                ))}
              </div>
            ) : null}
          </div>
        );
      };

      const initialStructure = {
        id: 'root',
        name: 'project-v1',
        type: 'folder',
        isOpen: true,
        children: [
          {
            id: '1',
            name: 'src',
            type: 'folder',
            isOpen: true,
            children: [
              {id: '1-1', name: 'App.js', type: 'file'},
              {id: '1-2', name: 'styles.css', type: 'file'},
            ],
          },
          {id: '2', name: 'assets', type: 'folder', isOpen: false, children: []},
          {id: '3', name: 'package.json', type: 'file'},
        ],
      };

      const cleanName = (value) => value.trim().replace(/\s+/g, '-');
      const generateId = () => Math.random().toString(36).substring(2, 10);

      function App() {
        const [structure, setStructure] = useState(initialStructure);
        const [selectedId, setSelectedId] = useState('root');
        const [outputFormat, setOutputFormat] = useState('json');
        const [itemName, setItemName] = useState('');
        const [pendingAction, setPendingAction] = useState(null);
        const [showInputModal, setShowInputModal] = useState(false);
        const [showImportModal, setShowImportModal] = useState(false);
        const [importTab, setImportTab] = useState('json');
        const [importJsonText, setImportJsonText] = useState('');
        const [importError, setImportError] = useState(null);
        const [isZipping, setIsZipping] = useState(false);
        const [zipLibLoaded, setZipLibLoaded] = useState(Boolean(window.JSZip));

        const zipInputRef = useRef(null);
        const jsonInputRef = useRef(null);

        useEffect(() => {
          if (window.JSZip) {
            setZipLibLoaded(true);
            return;
          }
          const script = document.createElement('script');
          script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js';
          script.async = true;
          script.onload = () => setZipLibLoaded(true);
          document.body.appendChild(script);
          return () => {
            if (document.body.contains(script)) {
              document.body.removeChild(script);
            }
          };
        }, []);
        const updateNode = (node, targetId, callback) => {
          if (node.id === targetId) {
            return callback(node);
          }
          if (node.children) {
            return {...node, children: node.children.map((child) => updateNode(child, targetId, callback))};
          }
          return node;
        };

        const deleteNodeRecursive = (node, targetId) => {
          if (!node.children) {
            return node;
          }
          return {
            ...node,
            children: node.children
              .filter((child) => child.id !== targetId)
              .map((child) => deleteNodeRecursive(child, targetId)),
          };
        };

        const handleToggle = (id) => {
          setStructure((prev) => updateNode(prev, id, (node) => ({...node, isOpen: !node.isOpen})));
        };

        const handleDelete = (id) => {
          if (id === 'root') return;
          if (window.confirm('Delete this item?')) {
            setStructure((prev) => deleteNodeRecursive(prev, id));
            if (selectedId === id) {
              setSelectedId('root');
            }
          }
        };

        const handleInitiateAdd = (parentId, type) => {
          setPendingAction({parentId, type});
          setItemName('');
          setShowInputModal(true);
        };

        const confirmAdd = () => {
          if (!pendingAction || !itemName.trim()) return;
          const newItem = {
            id: generateId(),
            name: cleanName(itemName),
            type: pendingAction.type,
            isOpen: true,
            children: pendingAction.type === 'folder' ? [] : undefined,
          };
          setStructure((prev) =>
            updateNode(prev, pendingAction.parentId, (node) => ({
              ...node,
              isOpen: true,
              children: [...(node.children || []), newItem],
            })),
          );
          setShowInputModal(false);
          setItemName('');
          setPendingAction(null);
        };

        const sanitizeImportedNode = (node) => {
          const safe = {...node};
          if (!safe.id) safe.id = generateId();
          if (!safe.name) safe.name = 'unnamed';
          if (!safe.type) safe.type = safe.children ? 'folder' : 'file';
          if (safe.type === 'folder' && safe.isOpen === undefined) safe.isOpen = true;
          if (safe.children && Array.isArray(safe.children)) {
            safe.children = safe.children.map((child) => sanitizeImportedNode(child));
          } else if (safe.type === 'folder' && !safe.children) {
            safe.children = [];
          }
          return safe;
        };

        const applyImportedData = (data) => {
          if (typeof data !== 'object' || !data.name) {
            throw new Error('Invalid JSON structure.');
          }
          const sanitized = sanitizeImportedNode(data);
          setStructure(sanitized);
          setShowImportModal(false);
          setImportJsonText('');
          setSelectedId(sanitized.id);
        };

        const handleJsonTextImport = () => {
          setImportError(null);
          try {
            const parsed = JSON.parse(importJsonText);
            applyImportedData(parsed);
          } catch (error) {
            setImportError('JSON Parse Error: ' + error.message);
          }
        };

        const handleJsonFileImport = (event) => {
          const file = event.target.files[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const parsed = JSON.parse(e.target.result);
              applyImportedData(parsed);
            } catch (error) {
              setImportError('Failed to read JSON file: ' + error.message);
            }
          };
          reader.readAsText(file);
          event.target.value = '';
        };

        const handleZipUpload = async (event) => {
          const file = event.target.files[0];
          if (!file) return;
          if (!window.JSZip) {
            setImportError('ZIP library is loading. Try again in a moment.');
            return;
          }
          setImportError(null);
          try {
            const zip = new window.JSZip();
            const content = await zip.loadAsync(file);
            const rootName = file.name.replace(/\.zip$/i, '') || 'imported-zip';
            const newStructure = {
              id: 'root',
              name: rootName,
              type: 'folder',
              isOpen: true,
              children: [],
            };

            Object.keys(content.files).forEach((relativePath) => {
              const fileEntry = content.files[relativePath];
              const parts = relativePath.split('/').filter(Boolean);
              let currentLevel = newStructure.children;

              parts.forEach((part, index) => {
                const isLast = index === parts.length - 1;
                const isFolder = fileEntry.dir || !isLast;
                let existingNode = currentLevel.find((n) => n.name === part);
                if (!existingNode) {
                  existingNode = {
                    id: generateId(),
                    name: part,
                    type: isFolder ? 'folder' : 'file',
                    isOpen: false,
                    children: isFolder ? [] : undefined,
                  };
                  currentLevel.push(existingNode);
                }
                if (isFolder) {
                  currentLevel = existingNode.children;
                }
              });
            });

            const sortNodes = (nodes) => {
              if (!nodes) return;
              nodes.sort((a, b) => {
                if (a.type === b.type) return a.name.localeCompare(b.name);
                return a.type === 'folder' ? -1 : 1;
              });
              nodes.forEach((node) => {
                if (node.children) sortNodes(node.children);
                if (node.id !== 'root') node.isOpen = false;
              });
            };

            sortNodes(newStructure.children);
            newStructure.isOpen = true;
            setStructure(newStructure);
            setShowImportModal(false);
            setSelectedId('root');
          } catch (error) {
            setImportError('Error reading ZIP file.');
          }
        };
        const generateScript = (node, path, format, depth) => {
          const lines = [];
          const currentPath = path ? `${path}/${node.name}` : node.name;
          const indentation = '  '.repeat(depth || 0);

          if (format === 'tree') {
            lines.push(`${indentation}- ${node.type === 'folder' ? '[dir]' : '[file]'} ${node.name}`);
            if (node.children) {
              node.children.forEach((child) => {
                lines.push(...generateScript(child, currentPath, format, (depth || 0) + 1));
              });
            }
            return lines;
          }

          if (format === 'bash') {
            if (node.type === 'folder') {
              lines.push(`mkdir -p "${currentPath}"`);
              if (node.children) {
                node.children.forEach((child) => lines.push(...generateScript(child, currentPath, format, depth)));
              }
            } else {
              lines.push(`touch "${currentPath}"`);
            }
            return lines;
          }

          if (format === 'powershell') {
            if (node.type === 'folder') {
              lines.push(`New-Item -ItemType Directory -Force -Path "${currentPath}"`);
              if (node.children) {
                node.children.forEach((child) => lines.push(...generateScript(child, currentPath, format, depth)));
              }
            } else {
              lines.push(`New-Item -ItemType File -Force -Path "${currentPath}"`);
            }
            return lines;
          }

          return lines;
        };

        const getOutput = () => {
          if (outputFormat === 'json') {
            return JSON.stringify(
              structure,
              (key, value) => {
                if (key === 'id' || key === 'isOpen') return undefined;
                return value;
              },
              2,
            );
          }
          const lines = generateScript(structure, '', outputFormat, 0);
          if (outputFormat === 'bash') {
            return `#!/bin/bash\n# Structure for ${structure.name}\n\n${lines.join('\n')}`;
          }
          if (outputFormat === 'powershell') {
            return `# PowerShell script\n\n${lines.join('\n')}`;
          }
          return lines.join('\n');
        };

        const copyToClipboard = async () => {
          try {
            await navigator.clipboard.writeText(getOutput());
          } catch (error) {
            window.alert('Clipboard unavailable. You can still select and copy manually.');
          }
        };

        const handleDownloadJsonFile = () => {
          const jsonString = JSON.stringify(
            structure,
            (key, value) => {
              if (key === 'id' || key === 'isOpen') return undefined;
              return value;
            },
            2,
          );
          const blob = new Blob([jsonString], {type: 'application/json'});
          const url = URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.href = url;
          link.download = `${structure.name}.json`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          URL.revokeObjectURL(url);
        };

        const processNodeForZip = (node, parentFolder) => {
          if (node.type === 'folder') {
            const folder = parentFolder.folder(node.name);
            if (node.children) {
              node.children.forEach((child) => processNodeForZip(child, folder));
            }
          } else {
            parentFolder.file(node.name, '');
          }
        };

        const handleDownloadZip = async () => {
          if (!window.JSZip) return;
          setIsZipping(true);
          try {
            const zip = new window.JSZip();
            processNodeForZip(structure, zip);
            const content = await zip.generateAsync({type: 'blob'});
            const url = window.URL.createObjectURL(content);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${structure.name}.zip`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
          } catch (error) {
            window.alert('Archiving Error');
          } finally {
            setIsZipping(false);
          }
        };

        return (
          <div className="min-h-screen flex flex-col text-slate-800 bg-gradient-to-b from-slate-900 via-slate-900 to-slate-950">
            <header className="bg-white border-b border-slate-200 px-6 py-4 flex flex-col sm:flex-row items-center justify-between sticky top-0 z-10 gap-4 shadow-sm">
              <div className="flex items-center gap-3 w-full sm:w-auto">
                <div className="bg-indigo-600 p-2 rounded-lg text-white shadow-md shadow-indigo-200">
                  <Icon name="archive" size={20} />
                </div>
                <div>
                  <p className="text-xs font-semibold text-slate-400 uppercase tracking-wide">Scaffold</p>
                  <h1 className="text-xl font-bold text-slate-800">
                    Folder Structure <span className="text-indigo-600">Builder</span>
                  </h1>
                </div>
              </div>

              <div className="flex gap-2 w-full sm:w-auto justify-end">
                <button
                  onClick={() => setShowImportModal(true)}
                  className="flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-slate-600 hover:bg-slate-100 border border-slate-200 transition-all"
                >
                  <Icon name="upload" size={18} />
                  <span className="hidden sm:inline">Import</span>
                  <span className="sm:hidden">Load</span>
                </button>

                <button
                  onClick={handleDownloadZip}
                  disabled={!zipLibLoaded || isZipping}
                  className={`flex items-center gap-2 px-4 py-2 rounded-lg font-semibold shadow-sm transition-all ${
                    !zipLibLoaded || isZipping
                      ? 'bg-slate-200 text-slate-400 cursor-not-allowed'
                      : 'bg-indigo-600 text-white hover:bg-indigo-700 hover:shadow-indigo-200'
                  }`}
                >
                  {isZipping ? (
                    <span className="flex items-center gap-2">Creating...</span>
                  ) : (
                    <>
                      <Icon name="download" size={18} />
                      <span className="hidden sm:inline">Download ZIP</span>
                      <span className="sm:hidden">ZIP</span>
                    </>
                  )}
                </button>
              </div>
            </header>

            <main className="flex-1 p-4 md:p-6 max-w-7xl mx-auto w-full grid grid-cols-1 lg:grid-cols-3 gap-6">
              <section className="lg:col-span-2 bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col overflow-hidden min-h-[500px]">
                <div className="p-4 border-b border-slate-100 bg-slate-50 flex justify-between items-center">
                  <div className="flex items-center gap-2 text-slate-700 font-semibold">
                    <Icon name="folder" size={18} className="text-indigo-500" />
                    Structure
                  </div>
                  <div className="text-xs text-slate-400 bg-white px-2 py-1 rounded border border-slate-100 truncate max-w-[150px]">
                    Root: {structure.name}
                  </div>
                </div>

                <div className="flex-1 overflow-y-auto p-4 custom-scrollbar">
                  <TreeItem
                    node={structure}
                    depth={0}
                    onAdd={handleInitiateAdd}
                    onDelete={handleDelete}
                    onToggle={handleToggle}
                    selectedId={selectedId}
                    onSelect={(node) => setSelectedId(node.id)}
                  />
                </div>
              </section>

              <section className="bg-slate-900 rounded-xl shadow-lg flex flex-col overflow-hidden min-h-[500px] text-slate-300 border border-slate-800">
                <div className="p-4 border-b border-slate-800 bg-slate-800">
                  <div className="flex items-center justify-between mb-3">
                    <div className="flex items-center gap-2 text-white font-medium">
                      {outputFormat === 'json' ? (
                        <Icon name="file-json" size={18} className="text-yellow-400" />
                      ) : (
                        <Icon name="terminal" size={18} className="text-indigo-300" />
                      )}
                      {outputFormat === 'json' ? 'Preset (JSON)' : 'Build script'}
                    </div>
                    <div className="flex gap-2">
                      {outputFormat === 'json' ? (
                        <button
                          onClick={handleDownloadJsonFile}
                          className="flex items-center gap-1.5 px-2 py-1 bg-yellow-600/20 hover:bg-yellow-600/40 text-yellow-400 text-xs rounded border border-yellow-600/30 transition-colors"
                          title="Download JSON file"
                        >
                          <Icon name="save" size={14} />
                          .json
                        </button>
                      ) : null}
                      <button
                        onClick={copyToClipboard}
                        className="p-1.5 hover:bg-slate-700 rounded text-slate-400 hover:text-white transition-colors"
                        title="Copy to clipboard"
                      >
                        <Icon name="copy" size={16} />
                      </button>
                    </div>
                  </div>

                  <div className="flex bg-slate-900 rounded-lg p-1 border border-slate-700">
                    {['json', 'bash', 'powershell', 'tree'].map((fmt) => (
                      <button
                        key={fmt}
                        onClick={() => setOutputFormat(fmt)}
                        className={`flex-1 px-2 py-1 text-[10px] sm:text-xs uppercase font-bold rounded-md transition-all ${
                          outputFormat === fmt ? 'bg-indigo-600 text-white' : 'hover:text-white text-slate-500'
                        }`}
                      >
                        {fmt === 'powershell' ? 'PS' : fmt}
                      </button>
                    ))}
                  </div>
                </div>

                <div className="flex-1 overflow-auto p-4 font-mono text-xs text-slate-400 custom-scrollbar">
                  <pre className="whitespace-pre-wrap break-all">{getOutput()}</pre>
                </div>
              </section>
            </main>

            {showInputModal ? (
              <div className="fixed inset-0 bg-slate-900/60 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
                <div className="bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden">
                  <div className="p-6">
                    <h3 className="text-lg font-bold mb-4 text-slate-800">
                      New {pendingAction && pendingAction.type === 'folder' ? 'Folder' : 'File'}
                    </h3>
                    <input
                      autoFocus
                      type="text"
                      placeholder="Name..."
                      className="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none text-slate-800"
                      value={itemName}
                      onChange={(event) => setItemName(event.target.value)}
                      onKeyDown={(event) => event.key === 'Enter' && confirmAdd()}
                    />
                  </div>
                  <div className="bg-slate-50 p-4 flex justify-end gap-3 border-t border-slate-100">
                    <button
                      onClick={() => setShowInputModal(false)}
                      className="px-4 py-2 text-slate-600 hover:bg-slate-200 rounded-lg"
                    >
                      Cancel
                    </button>
                    <button
                      onClick={confirmAdd}
                      disabled={!itemName.trim()}
                      className="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50"
                    >
                      Create
                    </button>
                  </div>
                </div>
              </div>
            ) : null}

            {showImportModal ? (
              <div className="fixed inset-0 bg-slate-900/60 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
                <div className="bg-white rounded-xl shadow-2xl w-full max-w-xl overflow-hidden flex flex-col max-h-[90vh]">
                  <div className="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                    <h3 className="text-lg font-bold text-slate-800 flex items-center gap-2">
                      <Icon name="upload" className="text-indigo-600" size={20} />
                      Import project
                    </h3>
                    <button
                      onClick={() => setShowImportModal(false)}
                      className="text-slate-400 hover:text-slate-600"
                      aria-label="Close"
                    >
                      x
                    </button>
                  </div>

                  <div className="p-4 border-b border-slate-100 flex gap-2">
                    <button
                      onClick={() => setImportTab('json')}
                      className={`flex-1 py-2 rounded-lg text-sm font-medium transition-all flex items-center justify-center gap-2 ${
                        importTab === 'json' ? 'bg-indigo-100 text-indigo-700' : 'text-slate-500 hover:bg-slate-50'
                      }`}
                    >
                      <Icon name="file-json" size={16} /> JSON
                    </button>
                    <button
                      onClick={() => setImportTab('zip')}
                      className={`flex-1 py-2 rounded-lg text-sm font-medium transition-all flex items-center justify-center gap-2 ${
                        importTab === 'zip' ? 'bg-indigo-100 text-indigo-700' : 'text-slate-500 hover:bg-slate-50'
                      }`}
                    >
                      <Icon name="file-archive" size={16} /> ZIP
                    </button>
                  </div>

                  <div className="p-6 flex-1 overflow-hidden flex flex-col">
                    {importError ? (
                      <div className="mb-4 p-3 bg-red-50 text-red-600 text-sm rounded-lg flex items-center gap-2">
                        <Icon name="alert-circle" size={16} />
                        {importError}
                      </div>
                    ) : null}

                    {importTab === 'json' ? (
                      <div className="flex-1 flex flex-col h-full">
                        <div className="grid grid-cols-2 gap-4 mb-4">
                          <div
                            className="col-span-2 sm:col-span-1 flex flex-col items-center justify-center h-32 border-2 border-dashed border-slate-300 rounded-xl bg-slate-50 hover:bg-indigo-50 hover:border-indigo-300 transition-all cursor-pointer"
                            onClick={() => jsonInputRef.current && jsonInputRef.current.click()}
                          >
                            <input
                              type="file"
                              accept=".json"
                              className="hidden"
                              ref={jsonInputRef}
                              onChange={handleJsonFileImport}
                            />
                            <Icon name="file-code" className="text-indigo-400 mb-2" size={24} />
                            <span className="text-xs font-medium text-slate-600">Upload .json file</span>
                          </div>

                          <div className="col-span-2 sm:col-span-1 flex items-center justify-center text-xs text-slate-500 p-2 text-center">
                            Or paste JSON below
                          </div>
                        </div>

                        <textarea
                          className="w-full flex-1 p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono text-xs text-slate-700 resize-none min-h-[100px]"
                          placeholder='{ "id": "root", "name": "project", "type": "folder" }'
                          value={importJsonText}
                          onChange={(event) => setImportJsonText(event.target.value)}
                        />
                        <div className="mt-4 flex justify-end">
                          <button
                            onClick={handleJsonTextImport}
                            disabled={!importJsonText.trim()}
                            className="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50"
                          >
                            Apply text
                          </button>
                        </div>
                      </div>
                    ) : (
                      <div
                        className="flex-1 flex flex-col items-center justify-center h-64 border-2 border-dashed border-slate-300 rounded-xl bg-slate-50 hover:bg-indigo-50 hover:border-indigo-300 transition-all cursor-pointer relative"
                        onClick={() => zipInputRef.current && zipInputRef.current.click()}
                      >
                        <input
                          type="file"
                          accept=".zip"
                          className="hidden"
                          ref={zipInputRef}
                          onChange={handleZipUpload}
                        />
                        <div className="bg-white p-4 rounded-full shadow-sm mb-3">
                          <Icon name="upload" size={32} className="text-indigo-500" />
                        </div>
                        <p className="text-sm font-medium text-slate-700">Select .zip file</p>
                        <p className="text-xs text-slate-400 mt-1">Folder tree is read locally</p>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            ) : null}
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>

