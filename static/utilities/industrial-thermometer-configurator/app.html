<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Industrial Thermometer Configurator</title>
  <script src="../../vendor/jspdf.umd.min.js"></script>
  <script src="../../vendor/html2canvas.min.js"></script>
  <script src="../../vendor/react.production.min.js"></script>
  <script src="../../vendor/react-dom.production.min.js"></script>
  <script src="../../vendor/babel.min.js"></script>
  <script src="../../vendor/tailwindcss.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
        },
      },
    };
  </script>
  <style>
    body {
      margin: 0;
      font-family: 'Inter', system-ui, sans-serif;
      background: #0e1014;
      color: #e5e7eb;
    }
  </style>
</head>

<body>
  <div id="root"></div>
  <script type="text/babel">
const { useState, useMemo, useEffect, useRef } = React;

const ICONS = {
  "settings": [
    [
      "path",
      {
        "d": "M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",
        "key": "1i5ecw"
      }
    ],
    [
      "circle",
      {
        "cx": "12",
        "cy": "12",
        "r": "3",
        "key": "1v7zrd"
      }
    ]
  ],
  "download": [
    [
      "path",
      {
        "d": "M12 15V3",
        "key": "m9g1x1"
      }
    ],
    [
      "path",
      {
        "d": "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",
        "key": "ih7n3h"
      }
    ],
    [
      "path",
      {
        "d": "m7 10 5 5 5-5",
        "key": "brsn70"
      }
    ]
  ],
  "thermometer": [
    [
      "path",
      {
        "d": "M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",
        "key": "17jzev"
      }
    ]
  ],
  "ruler": [
    [
      "path",
      {
        "d": "M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",
        "key": "icamh8"
      }
    ],
    [
      "path",
      {
        "d": "m14.5 12.5 2-2",
        "key": "inckbg"
      }
    ],
    [
      "path",
      {
        "d": "m11.5 9.5 2-2",
        "key": "fmmyf7"
      }
    ],
    [
      "path",
      {
        "d": "m8.5 6.5 2-2",
        "key": "vc6u1g"
      }
    ],
    [
      "path",
      {
        "d": "m17.5 15.5 2-2",
        "key": "wo5hmg"
      }
    ]
  ],
  "maximize-2": [
    [
      "path",
      {
        "d": "M15 3h6v6",
        "key": "1q9fwt"
      }
    ],
    [
      "path",
      {
        "d": "m21 3-7 7",
        "key": "1l2asr"
      }
    ],
    [
      "path",
      {
        "d": "m3 21 7-7",
        "key": "tjx5ai"
      }
    ],
    [
      "path",
      {
        "d": "M9 21H3v-6",
        "key": "wtvkvv"
      }
    ]
  ],
  "circle-check": [
    [
      "circle",
      {
        "cx": "12",
        "cy": "12",
        "r": "10",
        "key": "1mglay"
      }
    ],
    [
      "path",
      {
        "d": "m9 12 2 2 4-4",
        "key": "dzmm74"
      }
    ]
  ],
  "chevron-right": [
    [
      "path",
      {
        "d": "m9 18 6-6-6-6",
        "key": "mthhwq"
      }
    ]
  ],
  "clipboard-list": [
    [
      "rect",
      {
        "width": "8",
        "height": "4",
        "x": "8",
        "y": "2",
        "rx": "1",
        "ry": "1",
        "key": "tgr4d6"
      }
    ],
    [
      "path",
      {
        "d": "M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",
        "key": "116196"
      }
    ],
    [
      "path",
      {
        "d": "M12 11h4",
        "key": "1jrz19"
      }
    ],
    [
      "path",
      {
        "d": "M12 16h4",
        "key": "n85exb"
      }
    ],
    [
      "path",
      {
        "d": "M8 11h.01",
        "key": "1dfujw"
      }
    ],
    [
      "path",
      {
        "d": "M8 16h.01",
        "key": "18s6g9"
      }
    ]
  ],
  "external-link": [
    [
      "path",
      {
        "d": "M15 3h6v6",
        "key": "1q9fwt"
      }
    ],
    [
      "path",
      {
        "d": "M10 14 21 3",
        "key": "gplh6r"
      }
    ],
    [
      "path",
      {
        "d": "M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",
        "key": "a6xqqp"
      }
    ]
  ],
  "arrow-down-to-line": [
    [
      "path",
      {
        "d": "M12 17V3",
        "key": "1cwfxf"
      }
    ],
    [
      "path",
      {
        "d": "m6 11 6 6 6-6",
        "key": "12ii2o"
      }
    ],
    [
      "path",
      {
        "d": "M19 21H5",
        "key": "150jfl"
      }
    ]
  ],
  "move": [
    [
      "path",
      {
        "d": "M12 2v20",
        "key": "t6zp3m"
      }
    ],
    [
      "path",
      {
        "d": "m15 19-3 3-3-3",
        "key": "11eu04"
      }
    ],
    [
      "path",
      {
        "d": "m19 9 3 3-3 3",
        "key": "1mg7y2"
      }
    ],
    [
      "path",
      {
        "d": "M2 12h20",
        "key": "9i4pu4"
      }
    ],
    [
      "path",
      {
        "d": "m5 9-3 3 3 3",
        "key": "j64kie"
      }
    ],
    [
      "path",
      {
        "d": "m9 5 3-3 3 3",
        "key": "l8vdw6"
      }
    ]
  ],
  "tag": [
    [
      "path",
      {
        "d": "M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",
        "key": "vktsd0"
      }
    ],
    [
      "circle",
      {
        "cx": "7.5",
        "cy": "7.5",
        "r": ".5",
        "fill": "currentColor",
        "key": "kqv944"
      }
    ]
  ],
  "workflow": [
    [
      "rect",
      {
        "width": "8",
        "height": "8",
        "x": "3",
        "y": "3",
        "rx": "2",
        "key": "by2w9f"
      }
    ],
    [
      "path",
      {
        "d": "M7 11v4a2 2 0 0 0 2 2h4",
        "key": "xkn7yn"
      }
    ],
    [
      "rect",
      {
        "width": "8",
        "height": "8",
        "x": "13",
        "y": "13",
        "rx": "2",
        "key": "1cgmvn"
      }
    ]
  ],
  "scroll-text": [
    [
      "path",
      {
        "d": "M15 12h-5",
        "key": "r7krc0"
      }
    ],
    [
      "path",
      {
        "d": "M15 8h-5",
        "key": "1khuty"
      }
    ],
    [
      "path",
      {
        "d": "M19 17V5a2 2 0 0 0-2-2H4",
        "key": "zz82l3"
      }
    ],
    [
      "path",
      {
        "d": "M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",
        "key": "1ph1d7"
      }
    ]
  ],
  "thermometer-snowflake": [
    [
      "path",
      {
        "d": "m10 20-1.25-2.5L6 18",
        "key": "18frcb"
      }
    ],
    [
      "path",
      {
        "d": "M10 4 8.75 6.5 6 6",
        "key": "7mghy3"
      }
    ],
    [
      "path",
      {
        "d": "M10.585 15H10",
        "key": "4nqulp"
      }
    ],
    [
      "path",
      {
        "d": "M2 12h6.5L10 9",
        "key": "kv9z4n"
      }
    ],
    [
      "path",
      {
        "d": "M20 14.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0z",
        "key": "yu0u2z"
      }
    ],
    [
      "path",
      {
        "d": "m4 10 1.5 2L4 14",
        "key": "k9enpj"
      }
    ],
    [
      "path",
      {
        "d": "m7 21 3-6-1.5-3",
        "key": "j8hb9u"
      }
    ],
    [
      "path",
      {
        "d": "m7 3 3 6h2",
        "key": "1bbqgq"
      }
    ]
  ],
  "cylinder": [
    [
      "ellipse",
      {
        "cx": "12",
        "cy": "5",
        "rx": "9",
        "ry": "3",
        "key": "msslwz"
      }
    ],
    [
      "path",
      {
        "d": "M3 5v14a9 3 0 0 0 18 0V5",
        "key": "aqi0yr"
      }
    ]
  ],
  "refresh-cw": [
    [
      "path",
      {
        "d": "M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",
        "key": "v9h5vc"
      }
    ],
    [
      "path",
      {
        "d": "M21 3v5h-5",
        "key": "1q7to0"
      }
    ],
    [
      "path",
      {
        "d": "M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",
        "key": "3uifl3"
      }
    ],
    [
      "path",
      {
        "d": "M8 16H3v5",
        "key": "1cv678"
      }
    ]
  ],
  "component": [
    [
      "path",
      {
        "d": "M15.536 11.293a1 1 0 0 0 0 1.414l2.376 2.377a1 1 0 0 0 1.414 0l2.377-2.377a1 1 0 0 0 0-1.414l-2.377-2.377a1 1 0 0 0-1.414 0z",
        "key": "1uwlt4"
      }
    ],
    [
      "path",
      {
        "d": "M2.297 11.293a1 1 0 0 0 0 1.414l2.377 2.377a1 1 0 0 0 1.414 0l2.377-2.377a1 1 0 0 0 0-1.414L6.088 8.916a1 1 0 0 0-1.414 0z",
        "key": "10291m"
      }
    ],
    [
      "path",
      {
        "d": "M8.916 17.912a1 1 0 0 0 0 1.415l2.377 2.376a1 1 0 0 0 1.414 0l2.377-2.376a1 1 0 0 0 0-1.415l-2.377-2.376a1 1 0 0 0-1.414 0z",
        "key": "1tqoq1"
      }
    ],
    [
      "path",
      {
        "d": "M8.916 4.674a1 1 0 0 0 0 1.414l2.377 2.376a1 1 0 0 0 1.414 0l2.377-2.376a1 1 0 0 0 0-1.414l-2.377-2.377a1 1 0 0 0-1.414 0z",
        "key": "1x6lto"
      }
    ]
  ],
  "repeat": [
    [
      "path",
      {
        "d": "m17 2 4 4-4 4",
        "key": "nntrym"
      }
    ],
    [
      "path",
      {
        "d": "M3 11v-1a4 4 0 0 1 4-4h14",
        "key": "84bu3i"
      }
    ],
    [
      "path",
      {
        "d": "m7 22-4-4 4-4",
        "key": "1wqhfi"
      }
    ],
    [
      "path",
      {
        "d": "M21 13v1a4 4 0 0 1-4 4H3",
        "key": "1rx37r"
      }
    ]
  ]
};

const Icon = ({ name, size = 16, className = '' }) => {
  const nodes = ICONS[name];
  if (!nodes) return null;
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width={size}
      height={size}
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      strokeWidth="2"
      strokeLinecap="round"
      strokeLinejoin="round"
      className={className}
      aria-hidden="true"
    >
      {nodes.map(([tag, attrs], index) => {
        const { key, ...rest } = attrs;
        return React.createElement(tag, { ...rest, key: index });
      })}
    </svg>
  );
};

const Settings = (props) => <Icon name="settings" {...props} />;
const Download = (props) => <Icon name="download" {...props} />;
const Thermometer = (props) => <Icon name="thermometer" {...props} />;
const Ruler = (props) => <Icon name="ruler" {...props} />;
const Maximize2 = (props) => <Icon name="maximize-2" {...props} />;
const CheckCircle2 = (props) => <Icon name="circle-check" {...props} />;
const ChevronRight = (props) => <Icon name="chevron-right" {...props} />;
const ClipboardList = (props) => <Icon name="clipboard-list" {...props} />;
const ExternalLink = (props) => <Icon name="external-link" {...props} />;
const ArrowDownToLine = (props) => <Icon name="arrow-down-to-line" {...props} />;
const Move = (props) => <Icon name="move" {...props} />;
const Edit3 = (props) => <Icon name="edit-3" {...props} />;
const Tag = (props) => <Icon name="tag" {...props} />;
const Workflow = (props) => <Icon name="workflow" {...props} />;
const ScrollText = (props) => <Icon name="scroll-text" {...props} />;
const ThermometerSnowflake = (props) => <Icon name="thermometer-snowflake" {...props} />;
const Cylinder = (props) => <Icon name="cylinder" {...props} />;
const RefreshCw = (props) => <Icon name="refresh-cw" {...props} />;
const Component = (props) => <Icon name="component" {...props} />;
const RepeatIcon = (props) => <Icon name="repeat" {...props} />;

// Load libraries for PDF generation
const loadScripts = () => {
  if (!window.jspdf) {
    const jspdfScript = document.createElement('script');
    jspdfScript.src = '../../vendor/jspdf.umd.min.js';
    document.head.appendChild(jspdfScript);
  }
  if (!window.html2canvas) {
    const html2canvasScript = document.createElement('script');
    html2canvasScript.src = '../../vendor/html2canvas.min.js';
    document.head.appendChild(html2canvasScript);
  }
};

const App = () => {
  const previewRef = useRef(null);
  
  // State Management
  const [isCustomRange, setIsCustomRange] = useState(false);
  const [isCustomStemLength, setIsCustomStemLength] = useState(false);
  const [isCustomWellLength, setIsCustomWellLength] = useState(false);

  const [config, setConfig] = useState({
    model: 'TG-Industrial',
    nominalSize: 100, // 63, 100, 160
    unit: ' degC',
    rangeMin: 0,
    rangeMax: 100,
    
    // Measuring Element (Stem)
    stem: {
        length: 100, // L1 length in mm
        diameter: 8, // 6, 8, 10, 12 mm
        material: 'Stainless steel 316L'
    },

    // Connection
    connection: {
      location: 'Lower', // Lower (Radial), Back (Axial), Adjustable (Every-Angle)
      design: 'Standard', // Standard, Design 1, Design 2, Design 3, Design 4
      standard: 'G 1/2 B', // G 1/2 B, 1/2 NPT, M20x1.5
    },
    
    // Case
    case: {
      material: 'Stainless steel 1.4301 (304)',
      filling: 'Dry', // Dry, Silicone
      window: 'Safety glass'
    },

    // Thermowell Accessory
    accessories: {
      thermowell: {
        enabled: false,
        type: 'Solid Machined', // Solid Machined, Fabricated
        design: 'Tapered', // Tapered, Straight, Stepped
        material: 'Stainless steel 316Ti',
        processConnection: 'G 1/2 B',
        insertionLength: 100, // U length
        extensionLength: 0 // T length (Lagging)
      }
    },

    options: {
      redPointer: false,
      dragPointer: false,
      calibrationCert: true
    },

    project: {
      tagNumber: '',
      medium: 'Liquid/Gas',
      standard: 'EN 13190',
      certificates: 'EN 10204 3.1',
      orderNumber: '',
      operatorName: ''
    },

    otherTechnicalParams: `Design: EN 13190
Sensing element: Bimetal coil
Accuracy class: 1 per EN 13190
Stem pressure rating: max. 25 bar (static) without thermowell
Ambient temperature: -40...+70  degC
Ingress protection: IP 65 per IEC/EN 60529
Zero adjustment: External adjustment on case back`
  });

  useEffect(() => {
    loadScripts();
  }, []);

  // Update model based on filling
  useEffect(() => {
    setConfig(prev => ({
      ...prev,
      model: prev.case.filling === 'Dry' ? 'TG-Industrial' : 'TG-Vibro'
    }));
  }, [config.case.filling]);

  // Sync Thermowell length with Stem length automatically when Stem Length changes
  useEffect(() => {
    setConfig(prev => ({
        ...prev,
        accessories: {
            ...prev.accessories,
            thermowell: {
                ...prev.accessories.thermowell,
                insertionLength: prev.stem.length 
            }
        }
    }));
  }, [config.stem.length]);

  // Constants
  const nominalSizes = [63, 100, 160];
  const units = [' degC', ' degF'];
  const stemDiameters = [6, 8, 10];
  const stemLengths = [63, 100, 160, 200, 250, 300, 400, 500, 600, 800, 1000];
  
  const connectionDesigns = [
    { id: 'Standard', label: 'Standard (Fixed Thread)' },
    { id: 'Design 1', label: 'Design 1 (Plain Stem)' },
    { id: 'Design 2', label: 'Design 2 (Male Nut)' },
    { id: 'Design 3', label: 'Design 3 (Union Nut)' },
    { id: 'Design 4', label: 'Design 4 (Compr. Fitting)' },
  ];

  const ranges = [
    { min: -50, max: 50, label: '-50...+50' },
    { min: -30, max: 50, label: '-30...+50' },
    { min: 0, max: 60, label: '0...60' },
    { min: 0, max: 100, label: '0...100' },
    { min: 0, max: 120, label: '0...120' },
    { min: 0, max: 160, label: '0...160' },
    { min: 0, max: 200, label: '0...200' },
    { min: 0, max: 250, label: '0...250' },
    { min: 0, max: 300, label: '0...300' },
    { min: 0, max: 400, label: '0...400' },
    { min: 0, max: 500, label: '0...500' },
    { min: 0, max: 600, label: '0...600' },
  ];

  const connectionStandards = ['G 1/2 B', '1/2 NPT', 'M20x1.5', 'M27x2', 'G 3/4 B', '1/2 BSP'];
  const fillings = ['Dry', 'Silicone oil'];
  const wellMaterials = ['Stainless steel 316Ti', 'Stainless steel 316L', 'Hastelloy C276', 'Monel 400'];
  
  // Visual Calculations
  const visual = useMemo(() => {
    const svgSize = 600;
    
    const renderLength = config.accessories.thermowell.enabled 
        ? config.accessories.thermowell.insertionLength 
        : config.stem.length;

    let center = svgSize / 2;
    let scale = 1;
    
    // Adjust scale/center based on mounting
    const isLower = config.connection.location === 'Lower';
    const isAdjustable = config.connection.location === 'Adjustable';
    
    // Logarithmic scale for visual length to prevent drawing off-screen for 1000mm
    const visualStemLength = Math.min(280, Math.max(80, renderLength * 0.8));

    if (isLower || isAdjustable) {
      center = 200; 
      scale = 0.9;
    }

    let radius;
    if (config.nominalSize === 63) radius = 80 * scale;
    else if (config.nominalSize === 100) radius = 120 * scale;
    else radius = 150 * scale; 

    return {
      cx: svgSize / 2,
      cy: center,
      r: radius,
      rInner: radius * 0.92,
      rDial: radius * 0.85,
      stemLen: visualStemLength * scale,
      stemWidth: (config.stem.diameter * 2) * scale, 
      wellWidth: (config.stem.diameter * 3.5) * scale,
      scale: scale,
      // Extra offset for adjustable knuckle
      knuckleHeight: isAdjustable ? 25 * scale : 0
    };
  }, [config.nominalSize, config.connection.location, config.stem.length, config.stem.diameter, config.accessories]);

  // Handlers
  const updateConfig = (field, value) => setConfig(prev => ({ ...prev, [field]: value }));
  const updateProject = (field, value) => setConfig(prev => ({ ...prev, project: { ...prev.project, [field]: value } }));
  const updateSubConfig = (parent, field, value) => setConfig(prev => ({ ...prev, [parent]: { ...prev[parent], [field]: value } }));
  const updateStem = (field, value) => setConfig(prev => ({ ...prev, stem: { ...prev.stem, [field]: value } }));
  const updateAccessory = (type, field, value) => setConfig(prev => ({ 
    ...prev, 
    accessories: { 
      ...prev.accessories, 
      [type]: { ...prev.accessories[type], [field]: value } 
    } 
  }));
  const toggleAccessory = (type) => setConfig(prev => ({ 
    ...prev, 
    accessories: { 
      ...prev.accessories, 
      [type]: { ...prev.accessories[type], enabled: !prev.accessories[type].enabled } 
    } 
  }));
  const toggleOption = (opt) => setConfig(prev => ({ ...prev, options: { ...prev.options, [opt]: !prev.options[opt] } }));

  // PDF Generation
  const handleDownloadPDF = async () => {
    const { jspdf } = window;
    const html2canvas = window.html2canvas;
    if (!jspdf || !html2canvas) return;

    const canvas = await html2canvas(previewRef.current, {
      backgroundColor: '#ffffff',
      scale: 2, 
      useCORS: true,
      logging: false,
      onclone: (clonedDoc) => {
        const el = clonedDoc.querySelector('#blueprint-capture-area');
        if (el) {
            el.style.background = '#ffffff';
            el.style.border = 'none';
        }
      }
    });
    const sketchImg = canvas.toDataURL('image/jpeg', 0.9);

    const doc = new jspdf.jsPDF({ orientation: 'p', unit: 'mm', format: 'a4', compress: true });
    const pageWidth = doc.internal.pageSize.getWidth();
    const pageHeight = doc.internal.pageSize.getHeight();
    const margin = 20;
    let y = 20;

    // Header
    doc.setFont('helvetica', 'bold'); doc.setFontSize(18); doc.setTextColor(220, 38, 38); 
    doc.text('TECHNICAL DATA SHEET', margin, y);
    y += 8; doc.setFontSize(9); doc.setTextColor(100);
    doc.text('INDUSTRIAL BIMETAL THERMOMETER SPECIFICATION', margin, y);
    y += 4; doc.line(margin, y, 190, y); y += 12;

    const section = (title, data) => {
      // Check for page break
      if (y > pageHeight - 60) {
          doc.addPage();
          y = 20;
      }
      doc.setFont('helvetica', 'bold'); doc.setFontSize(11); doc.setFillColor(245, 245, 245);
      doc.rect(margin, y, 170, 7, 'F'); doc.setTextColor(40); doc.text(title.toUpperCase(), margin + 2, y + 5);
      y += 12; doc.setFont('helvetica', 'normal'); doc.setFontSize(10);
      data.forEach(item => {
        doc.setTextColor(100); doc.text(item.label + ':', margin + 5, y);
        doc.setTextColor(0); doc.text(String(item.value || '-'), margin + 75, y); y += 7;
      });
      y += 5;
    };

    const textSection = (title, text) => {
      if (y > pageHeight - 60) { doc.addPage(); y = 20; }
      
      doc.setFont('helvetica', 'bold'); doc.setFontSize(11); doc.setFillColor(245, 245, 245);
      doc.rect(margin, y, 170, 7, 'F'); doc.setTextColor(40); doc.text(title.toUpperCase(), margin + 2, y + 5);
      y += 12; doc.setFont('helvetica', 'normal'); doc.setFontSize(10); doc.setTextColor(0);
      
      const lines = doc.splitTextToSize(text, 170);
      lines.forEach(line => {
        if (y > pageHeight - 30) { doc.addPage(); y = 20; }
        doc.text(line, margin + 5, y);
        y += 5;
      });
      y += 5;
    };

    // Helper to get formatted location string
    const getLocationString = (loc) => {
        if (loc === 'Lower') return 'Radial (Lower)';
        if (loc === 'Back') return 'Axial (Back)';
        if (loc === 'Adjustable') return 'Every-Angle (Adjustable)';
        return loc;
    };

    // Helper to get formatted design string
    const getDesignString = (id) => {
        const d = connectionDesigns.find(cd => cd.id === id);
        return d ? d.label : id;
    };

    section('1. Project Data', [
      { label: 'Tag Number', value: config.project.tagNumber },
      { label: 'Order Number', value: config.project.orderNumber },
      { label: 'Customer', value: config.project.operatorName },
      { label: 'Date', value: new Date().toLocaleDateString() },
    ]);

    section('2. Technical Specifications', [
      { label: 'Model', value: config.model },
      { label: 'Nominal Size', value: `NS ${config.nominalSize} mm` },
      { label: 'Scale Range', value: `${config.rangeMin} ... ${config.rangeMax} ${config.unit}` },
      { label: 'Case Filling', value: config.case.filling }
    ]);

    section('3. Stem & Connection', [
      { label: 'Mounting', value: getLocationString(config.connection.location) },
      { label: 'Connection Design', value: getDesignString(config.connection.design) },
      { label: 'Process Connection', value: config.connection.standard },
      { label: 'Stem Length (L1)', value: `${config.stem.length} mm` },
      { label: 'Stem Diameter', value: `${config.stem.diameter} mm` },
      { label: 'Stem Material', value: config.stem.material },
    ]);

    section('4. Thermowell (Accessory)', [
       { label: 'Thermowell', value: config.accessories.thermowell.enabled ? `Included (${config.accessories.thermowell.type})` : 'None' },
       { label: 'Design', value: config.accessories.thermowell.enabled ? config.accessories.thermowell.design : '-' },
       { label: 'Insertion Length (U)', value: config.accessories.thermowell.enabled ? `${config.accessories.thermowell.insertionLength} mm` : '-' },
       { label: 'Material', value: config.accessories.thermowell.enabled ? config.accessories.thermowell.material : '-' },
       { label: 'Process Connection', value: config.accessories.thermowell.enabled ? config.accessories.thermowell.processConnection : '-' },
    ]);

    section('5. Options', [
        { label: 'Red Set Pointer', value: config.options.redPointer ? 'Yes' : 'No' },
        { label: 'Calibration Certificate', value: config.options.calibrationCert ? 'Included' : 'No' },
    ]);

    textSection('6. Other Technical Parameters', config.otherTechnicalParams);

    // Sketch Page
    doc.addPage();
    doc.text('PRELIMINARY SKETCH', pageWidth / 2, 20, { align: 'center' });
    doc.addImage(sketchImg, 'JPEG', (pageWidth - 140) / 2, 40, 140, 140);

    // --- FOOTER GENERATION ---
    const totalPages = doc.internal.getNumberOfPages();
    for (let i = 1; i <= totalPages; i++) {
        doc.setPage(i);
        doc.setFont('helvetica', 'italic');
        doc.setFontSize(8);
        doc.setTextColor(150);

        // Footer Left: Website Link
        doc.textWithLink('cadautoscript.com', margin, pageHeight - 10, { url: 'https://cadautoscript.com' });
        
        // Footer Right: Page Numbering
        doc.text(`Page ${i} of ${totalPages}`, pageWidth - margin, pageHeight - 10, { align: 'right' });
    }
    
    doc.save(`Thermometer_Spec_${config.project.orderNumber || 'Draft'}.pdf`);
  };

  // Scale Ticks Renderer
  const ScaleTicks = ({ r, min, max }) => {
    const startAngle = 225;
    const sweep = 270;
    const ticks = [];
    const majorCount = 10;
    const minorPerMajor = 4;

    const isSmall = r < 75;
    const majorTickLen = isSmall ? 8 : 12;
    const minorTickLen = isSmall ? 4 : 6;
    const textOffset = isSmall ? 16 : 25;
    const fontSize = isSmall ? 8 : 10;
    const strokeW = isSmall ? 1.5 : 2.5;

    for (let i = 0; i <= majorCount * minorPerMajor; i++) {
      const progress = i / (majorCount * minorPerMajor);
      const angle = startAngle - (progress * sweep);
      const isMajor = i % minorPerMajor === 0;
      
      const rad = (angle * Math.PI) / 180;
      
      const currentLen = isMajor ? majorTickLen : minorTickLen;
      
      const x1 = Math.cos(rad) * (r - currentLen);
      const y1 = -Math.sin(rad) * (r - currentLen);
      const x2 = Math.cos(rad) * r;
      const y2 = -Math.sin(rad) * r;

      ticks.push(
        <line 
          key={i} 
          x1={x1} y1={y1} x2={x2} y2={y2} 
          stroke={isMajor ? "#000" : "#666"} 
          strokeWidth={isMajor ? strokeW : 1} 
        />
      );

      if (isMajor) {
        const tx = Math.cos(rad) * (r - textOffset);
        const ty = -Math.sin(rad) * (r - textOffset);
        const val = min + ((max - min) * progress);
        ticks.push(
          <text 
            key={`t-${i}`} 
            x={tx} y={ty + (isSmall ? 3 : 4)} 
            textAnchor="middle" 
            className="font-bold font-sans fill-black"
            style={{ fontSize: fontSize }}
          >
            {Math.round(val)}
          </text>
        );
      }
    }
    return <g>{ticks}</g>;
  };

  // Helper for rendering connection drawings based on design
  const ConnectionDrawing = ({ type, visual }) => {
    const { stemWidth, stemLen, scale } = visual;
    
    switch(type) {
        case 'Design 1': // Plain Stem
            return (
                 <g>
                    {/* Just the plain stem from the case down */}
                    <rect x={-stemWidth/2} y="0" width={stemWidth} height={stemLen + 35} fill="url(#stemGrad)" stroke="#999" />
                 </g>
            );
        case 'Design 2': // Male Nut (Turnable)
            return (
                 <g>
                    {/* Small neck */}
                    <rect x={-stemWidth/2} y="0" width={stemWidth} height={10} fill="#ddd" stroke="#999" />
                    {/* Hex Nut (Separate) */}
                    <path d={`M -${stemWidth * 1.5} 10 L ${stemWidth * 1.5} 10 L ${stemWidth * 1.5} 25 L -${stemWidth * 1.5} 25 Z`} fill="#ccc" stroke="#888" />
                    {/* Thread */}
                    <rect x={-stemWidth * 1.2} y="25" width={stemWidth * 2.4} height="20" fill="url(#stemGrad)" stroke="#888" />
                    <line x1={-stemWidth * 1.2} y1="30" x2={stemWidth * 1.2} y2="30" stroke="#666" strokeWidth="0.5"/>
                    <line x1={-stemWidth * 1.2} y1="35" x2={stemWidth * 1.2} y2="35" stroke="#666" strokeWidth="0.5"/>
                    {/* Stem continues */}
                    <rect x={-stemWidth/2} y="45" width={stemWidth} height={stemLen - 10} fill="url(#stemGrad)" stroke="#999" />
                 </g>
            );
        case 'Design 3': // Union Nut (Female)
            return (
                 <g>
                    {/* Hex Nut (Larger, Union) */}
                    <path d={`M -${stemWidth * 1.6} 0 L ${stemWidth * 1.6} 0 L ${stemWidth * 1.6} 25 L -${stemWidth * 1.6} 25 Z`} fill="#d4d4d4" stroke="#666" />
                    {/* Visual ridges on nut */}
                    <line x1={-stemWidth * 1.6} y1="5" x2={stemWidth * 1.6} y2="5" stroke="#aaa" strokeWidth="0.5"/>
                    <line x1={-stemWidth * 1.6} y1="20" x2={stemWidth * 1.6} y2="20" stroke="#aaa" strokeWidth="0.5"/>
                    {/* Stem continues */}
                    <rect x={-stemWidth/2} y="25" width={stemWidth} height={stemLen + 10} fill="url(#stemGrad)" stroke="#999" />
                 </g>
            );
        case 'Design 4': // Compression Fitting (Sliding)
            return (
                 <g>
                    {/* Plain stem all the way */}
                    <rect x={-stemWidth/2} y="0" width={stemWidth} height={stemLen + 35} fill="url(#stemGrad)" stroke="#999" />
                    
                    {/* Sliding Fitting drawn lower down */}
                    <g transform="translate(0, 40)">
                         {/* Hex */}
                         <path d={`M -${stemWidth * 1.5} 0 L ${stemWidth * 1.5} 0 L ${stemWidth * 1.5} 12 L -${stemWidth * 1.5} 12 Z`} fill="#ccc" stroke="#888" />
                         {/* Thread block */}
                         <rect x={-stemWidth * 1.2} y="12" width={stemWidth * 2.4} height="15" fill="url(#stemGrad)" stroke="#888" />
                         <line x1={-stemWidth * 1.2} y1="16" x2={stemWidth * 1.2} y2="16" stroke="#666" strokeWidth="0.5"/>
                         <line x1={-stemWidth * 1.2} y1="20" x2={stemWidth * 1.2} y2="20" stroke="#666" strokeWidth="0.5"/>
                    </g>
                 </g>
            );
        default: // Standard (Fixed)
            return (
                 <g>
                     {/* Hex Nut */}
                     <path d={`M -${stemWidth * 1.5} 0 L ${stemWidth * 1.5} 0 L ${stemWidth * 1.5} 15 L -${stemWidth * 1.5} 15 Z`} fill="#ccc" stroke="#888" />
                     {/* Thread Block */}
                     <rect x={-stemWidth * 1.2} y="15" width={stemWidth * 2.4} height="20" fill="url(#stemGrad)" stroke="#888" />
                     <line x1={-stemWidth * 1.2} y1="20" x2={stemWidth * 1.2} y2="20" stroke="#666" strokeWidth="0.5"/>
                     <line x1={-stemWidth * 1.2} y1="25" x2={stemWidth * 1.2} y2="25" stroke="#666" strokeWidth="0.5"/>
                     <line x1={-stemWidth * 1.2} y1="30" x2={stemWidth * 1.2} y2="30" stroke="#666" strokeWidth="0.5"/>
                     {/* Stem */}
                     <rect x={-stemWidth/2} y="35" width={stemWidth} height={stemLen} fill="url(#stemGrad)" stroke="#999" />
                 </g>
            );
    }
  };

  return (
    <div className="min-h-screen bg-[#111] text-gray-200 font-sans p-4 md:p-8 selection:bg-red-500/30">
      
      {/* Header */}
      <div className="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center mb-10 border-b border-white/5 pb-8">
        <div className="flex items-center gap-6">
          <div className="bg-red-600/10 p-4 rounded-2xl border border-red-500/20 shadow-[0_0_20px_rgba(220,38,38,0.1)]">
            <ThermometerSnowflake className="text-red-500 w-8 h-8" />
          </div>
          <div>
            <h1 className="text-3xl md:text-4xl font-black tracking-tighter text-white uppercase italic leading-none">
              Configurator
            </h1>
            <div className="flex items-center gap-2 text-gray-500 text-sm mt-2 uppercase tracking-widest font-bold font-mono">
              <span className="text-red-500">Industrial Thermometer</span>
              <ChevronRight size={14} />
              <span className="text-gray-400">Series {config.model}</span>
            </div>
          </div>
        </div>
        <button onClick={handleDownloadPDF} className="group mt-6 md:mt-0 flex items-center gap-3 bg-white text-black hover:bg-red-500 hover:text-white px-8 py-4 rounded-2xl font-bold transition-all shadow-xl active:scale-95">
          <Download size={20} /> Download PDF
        </button>
      </div>

      <div className="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        {/* Left Column: Controls */}
        <div className="lg:col-span-5 space-y-6 h-[calc(100vh-200px)] overflow-y-auto pr-2 custom-scrollbar">
          
          {/* Project Info */}
          <section className="bg-[#16161a] p-6 rounded-3xl shadow-xl border border-white/5">
            <h2 className="text-xs font-black mb-4 uppercase tracking-widest text-blue-400 flex items-center gap-2">
              <ClipboardList size={16} /> Project Data
            </h2>
            <div className="space-y-4">
               <div className="space-y-1">
                  <label className="text-[10px] text-gray-500 uppercase font-bold text-red-400">Tag Number (Position)</label>
                  <div className="flex items-center gap-2 bg-[#1c1c21] border border-red-500/30 rounded-xl p-3 focus-within:ring-2 focus-within:ring-red-500/50">
                    <Tag size={16} className="text-red-500"/>
                    <input 
                      type="text" 
                      value={config.project.tagNumber} 
                      onChange={(e) => updateProject('tagNumber', e.target.value)} 
                      className="w-full bg-transparent outline-none text-sm font-bold placeholder-gray-600" 
                      placeholder="e.g. TI-2004" 
                    />
                  </div>
               </div>
               <div className="grid grid-cols-2 gap-4">
                <div className="space-y-1">
                  <label className="text-[10px] text-gray-500 uppercase font-bold">Customer</label>
                  <input type="text" value={config.project.operatorName} onChange={(e) => updateProject('operatorName', e.target.value)} className="w-full bg-[#1c1c21] border border-white/5 rounded-xl p-3 outline-none focus:ring-2 focus:ring-red-500/50 text-sm" />
                </div>
                <div className="space-y-1">
                   <label className="text-[10px] text-gray-500 uppercase font-bold">Model</label>
                   <div className="p-3 bg-[#1c1c21] border border-white/5 rounded-xl text-sm font-bold text-gray-300">{config.model}</div>
                </div>
              </div>
            </div>
          </section>

          {/* Technical Specs */}
          <section className="bg-[#16161a] p-6 rounded-3xl shadow-xl border border-white/5">
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-xs font-black uppercase tracking-widest text-orange-400 flex items-center gap-2">
                <Maximize2 size={16} /> Dial Size & Range
              </h2>
            </div>
            
            <div className="space-y-4">
              {/* NS Selection */}
              <div className="space-y-2">
                <label className="text-[10px] text-gray-500 uppercase font-bold ml-1">Nominal Size (NS)</label>
                <div className="flex gap-2">
                  {nominalSizes.map(size => (
                    <button 
                      key={size}
                      onClick={() => updateConfig('nominalSize', size)}
                      className={`flex-1 py-3 rounded-xl border text-sm font-bold transition-all ${config.nominalSize === size ? 'bg-orange-600/20 border-orange-500 text-orange-500 shadow-[0_0_15px_rgba(249,115,22,0.2)]' : 'bg-[#1c1c21] border-white/5 text-gray-500 hover:bg-[#25252b]'}`}
                    >
                      {size} mm
                    </button>
                  ))}
                </div>
              </div>

              {/* Range & Unit */}
              <div className="grid grid-cols-3 gap-3">
                 <div className="col-span-1 space-y-1">
                    <label className="text-[10px] text-gray-500 uppercase font-bold ml-1">Unit</label>
                    <select value={config.unit} onChange={(e) => updateConfig('unit', e.target.value)} className="w-full bg-[#1c1c21] border border-white/5 rounded-xl p-3 outline-none text-sm font-bold">
                      {units.map(u => <option key={u}>{u}</option>)}
                    </select>
                 </div>
                 <div className="col-span-2 space-y-1">
                    <div className="flex justify-between items-end">
                      <label className="text-[10px] text-gray-500 uppercase font-bold ml-1">Scale Range</label>
                      <button 
                        onClick={() => setIsCustomRange(!isCustomRange)} 
                        className="text-[10px] text-orange-500 font-bold uppercase hover:text-white transition-colors flex items-center gap-1 pb-1"
                      >
                         <Edit3 size={10} />
                         {isCustomRange ? 'Select Standard' : 'Set Custom'}
                      </button>
                    </div>

                    {isCustomRange ? (
                      <div className="flex gap-2">
                        <input 
                          type="number" 
                          value={config.rangeMin} 
                          onChange={(e) => updateConfig('rangeMin', Number(e.target.value))}
                          className="w-1/2 bg-[#1c1c21] border border-white/5 rounded-xl p-3 outline-none text-sm font-bold focus:border-orange-500 transition-colors"
                        />
                        <input 
                          type="number" 
                          value={config.rangeMax} 
                          onChange={(e) => updateConfig('rangeMax', Number(e.target.value))}
                          className="w-1/2 bg-[#1c1c21] border border-white/5 rounded-xl p-3 outline-none text-sm font-bold focus:border-orange-500 transition-colors"
                        />
                      </div>
                    ) : (
                      <select 
                        value={ranges.find(r => r.min === config.rangeMin && r.max === config.rangeMax)?.label || ''}
                        onChange={(e) => {
                          const selectedRange = ranges.find(r => r.label === e.target.value);
                          if (selectedRange) {
                              updateConfig('rangeMin', selectedRange.min);
                              updateConfig('rangeMax', selectedRange.max);
                          }
                        }} 
                        className="w-full bg-[#1c1c21] border border-white/5 rounded-xl p-3 outline-none text-sm font-bold"
                      >
                        {ranges.map((r, i) => <option key={i} value={r.label}>{r.label}</option>)}
                      </select>
                    )}
                 </div>
              </div>

              {/* Filling */}
              <div className="space-y-2 pt-2">
                <label className="text-[10px] text-gray-500 uppercase font-bold ml-1">Case Filling (Damping)</label>
                <div className="grid grid-cols-2 gap-2">
                   {fillings.map(f => (
                     <button 
                      key={f}
                      onClick={() => updateSubConfig('case', 'filling', f)}
                      className={`py-2 px-1 rounded-lg border text-[10px] font-bold uppercase transition-all ${config.case.filling === f ? 'bg-blue-600/20 border-blue-500 text-blue-400' : 'bg-[#1c1c21] border-white/5 text-gray-600'}`}
                     >
                       {f === 'Silicone oil' ? 'Silicone (Vibro)' : 'None (Dry)'}
                     </button>
                   ))}
                </div>
              </div>
            </div>
          </section>

          {/* Stem & Connection */}
          <section className="bg-[#16161a] p-6 rounded-3xl shadow-xl border border-white/5">
            <h2 className="text-xs font-black mb-4 uppercase tracking-widest text-green-400 flex items-center gap-2">
              <Ruler size={16} /> Stem & Connection
            </h2>
            <div className="space-y-4">
              
               <div className="grid grid-cols-3 gap-3">
                 <button 
                    onClick={() => updateSubConfig('connection', 'location', 'Lower')}
                    className={`p-3 rounded-xl border text-xs font-bold transition-all flex flex-col items-center gap-2 ${config.connection.location === 'Lower' ? 'bg-green-600/20 border-green-500 text-green-400' : 'bg-[#1c1c21] border-white/5 text-gray-500'}`}
                 >
                    <ArrowDownToLine size={20} />
                    <span>Radial</span>
                 </button>
                 <button 
                    onClick={() => updateSubConfig('connection', 'location', 'Back')}
                    className={`p-3 rounded-xl border text-xs font-bold transition-all flex flex-col items-center gap-2 ${config.connection.location === 'Back' ? 'bg-green-600/20 border-green-500 text-green-400' : 'bg-[#1c1c21] border-white/5 text-gray-500'}`}
                 >
                    <div className="w-5 h-5 rounded-full border-2 border-current flex items-center justify-center"><div className="w-1 h-1 bg-current rounded-full"></div></div>
                    <span>Axial</span>
                 </button>
                 <button 
                    onClick={() => updateSubConfig('connection', 'location', 'Adjustable')}
                    className={`p-3 rounded-xl border text-xs font-bold transition-all flex flex-col items-center gap-2 ${config.connection.location === 'Adjustable' ? 'bg-green-600/20 border-green-500 text-green-400' : 'bg-[#1c1c21] border-white/5 text-gray-500'}`}
                 >
                    <RepeatIcon size={20} className="rotate-90" />
                    <span>Adjustable</span>
                 </button>
              </div>

              {/* Connection Design Selector */}
              <div className="space-y-1">
                <label className="text-[10px] text-gray-500 uppercase font-bold ml-1 text-green-400 flex items-center gap-2">
                   <Component size={12}/> Connection Design (Execution)
                </label>
                <select 
                  value={config.connection.design}
                  onChange={(e) => updateSubConfig('connection', 'design', e.target.value)} 
                  className="w-full bg-[#1c1c21] border border-green-500/30 rounded-xl p-3 outline-none text-sm font-bold"
                >
                  {connectionDesigns.map(d => <option key={d.id} value={d.id}>{d.label}</option>)}
                </select>
              </div>

              {/* Thread Selector (Only if not plain stem) */}
              {!config.connection.design.includes('Design 1') && (
                  <div className="space-y-1">
                    <label className="text-[10px] text-gray-500 uppercase font-bold ml-1">Process Connection</label>
                    <select 
                      value={config.connection.standard}
                      onChange={(e) => updateSubConfig('connection', 'standard', e.target.value)} 
                      className="w-full bg-[#1c1c21] border border-white/5 rounded-xl p-3 outline-none text-sm font-bold"
                    >
                      {connectionStandards.map(s => <option key={s}>{s}</option>)}
                    </select>
                  </div>
              )}

               {/* Stem Dimensions */}
               <div className="grid grid-cols-2 gap-3">
                  <div className="space-y-1">
                    <div className="flex justify-between items-end">
                        <label className="text-[10px] text-gray-500 uppercase font-bold ml-1 text-green-400">Stem Length (L1)</label>
                        <button 
                            onClick={() => setIsCustomStemLength(!isCustomStemLength)} 
                            className="text-[10px] text-green-500 font-bold uppercase hover:text-white transition-colors flex items-center gap-1 pb-1"
                        >
                            <Edit3 size={10} />
                            {isCustomStemLength ? 'Select Standard' : 'Set Custom'}
                        </button>
                    </div>
                    {isCustomStemLength ? (
                        <input 
                          type="number" 
                          value={config.stem.length} 
                          onChange={(e) => updateStem('length', Number(e.target.value))}
                          className="w-full bg-[#1c1c21] border border-green-500/30 rounded-xl p-3 outline-none text-sm font-bold focus:ring-1 focus:ring-green-500 transition-colors placeholder-gray-600"
                          placeholder="Length in mm"
                        />
                    ) : (
                        <select 
                          value={config.stem.length}
                          onChange={(e) => updateStem('length', Number(e.target.value))} 
                          className="w-full bg-[#1c1c21] border border-green-500/30 rounded-xl p-3 outline-none text-sm font-bold focus:ring-1 focus:ring-green-500"
                        >
                          {stemLengths.map(l => <option key={l} value={l}>{l} mm</option>)}
                        </select>
                    )}
                  </div>
                  <div className="space-y-1">
                    <label className="text-[10px] text-gray-500 uppercase font-bold ml-1">Diameter (Od)</label>
                    <select 
                      value={config.stem.diameter}
                      onChange={(e) => updateStem('diameter', Number(e.target.value))} 
                      className="w-full bg-[#1c1c21] border border-white/5 rounded-xl p-3 outline-none text-sm font-bold"
                    >
                      {stemDiameters.map(d => <option key={d} value={d}>{d} mm</option>)}
                    </select>
                  </div>
               </div>
            </div>
          </section>

          {/* Thermowell Section */}
          <section className="bg-[#16161a] p-6 rounded-3xl shadow-xl border border-white/5">
             <h2 className="text-xs font-black mb-4 uppercase tracking-widest text-cyan-400 flex items-center gap-2">
              <Cylinder size={16} /> Thermowell Config
            </h2>
            <div className="space-y-6">
              
              <div className="space-y-3 p-3 rounded-xl bg-[#1c1c21]/50 border border-white/5">
                <div className="flex justify-between items-center">
                  <label className="text-[11px] text-gray-400 uppercase font-bold">Enable Thermowell</label>
                  <button onClick={() => toggleAccessory('thermowell')} className={`w-10 h-6 rounded-full transition-colors relative ${config.accessories.thermowell.enabled ? 'bg-cyan-600' : 'bg-gray-700'}`}>
                    <div className={`w-4 h-4 rounded-full bg-white absolute top-1 transition-all ${config.accessories.thermowell.enabled ? 'left-5' : 'left-1'}`}></div>
                  </button>
                </div>
                {config.accessories.thermowell.enabled && (
                  <div className="grid grid-cols-1 gap-3 animate-in fade-in slide-in-from-top-2 duration-200 mt-2">
                    
                    {/* Thermowell Length Config */}
                    <div className="grid grid-cols-2 gap-3">
                        <div className="space-y-1">
                            <div className="flex justify-between items-end">
                                <label className="text-[9px] text-cyan-400 uppercase font-bold">Insertion Length (U)</label>
                                <button 
                                    onClick={() => setIsCustomWellLength(!isCustomWellLength)} 
                                    className="text-[9px] text-cyan-500 font-bold uppercase hover:text-white transition-colors flex items-center gap-1 pb-1"
                                >
                                    <Edit3 size={9} />
                                    {isCustomWellLength ? 'Std' : 'Edit'}
                                </button>
                            </div>
                            {isCustomWellLength ? (
                                <input 
                                  type="number" 
                                  value={config.accessories.thermowell.insertionLength} 
                                  onChange={(e) => updateAccessory('thermowell', 'insertionLength', Number(e.target.value))}
                                  className="w-full bg-[#0f0f11] border border-cyan-500/30 rounded-lg p-2 text-xs font-bold outline-none text-white"
                                />
                            ) : (
                                <div className="relative">
                                    <select 
                                        value={config.accessories.thermowell.insertionLength} 
                                        onChange={(e) => updateAccessory('thermowell', 'insertionLength', Number(e.target.value))} 
                                        className="w-full bg-[#0f0f11] border border-cyan-500/30 rounded-lg p-2 text-xs font-bold outline-none appearance-none"
                                        disabled={!isCustomWellLength && config.stem.length === config.accessories.thermowell.insertionLength} // Optionally disable if synced
                                    >
                                        {stemLengths.map(l => <option key={l} value={l}>{l} mm</option>)}
                                        {/* Add current custom length if it's not in the list */}
                                        {!stemLengths.includes(config.accessories.thermowell.insertionLength) && (
                                            <option value={config.accessories.thermowell.insertionLength}>{config.accessories.thermowell.insertionLength} mm (Custom)</option>
                                        )}
                                    </select>
                                    {!isCustomWellLength && <div className="absolute right-2 top-2 text-cyan-500 pointer-events-none"><RefreshCw size={10}/></div>}
                                </div>
                            )}
                        </div>
                        <div className="space-y-1">
                            <label className="text-[9px] text-gray-500 uppercase font-bold">Design</label>
                            <select value={config.accessories.thermowell.design} onChange={(e) => updateAccessory('thermowell', 'design', e.target.value)} className="w-full bg-[#0f0f11] border border-white/10 rounded-lg p-2 text-xs font-bold outline-none">
                                <option>Tapered</option>
                                <option>Straight</option>
                                <option>Stepped</option>
                            </select>
                        </div>
                    </div>

                    <div className="space-y-1">
                      <label className="text-[9px] text-gray-500 uppercase font-bold">Construction</label>
                      <select value={config.accessories.thermowell.type} onChange={(e) => updateAccessory('thermowell', 'type', e.target.value)} className="w-full bg-[#0f0f11] border border-white/10 rounded-lg p-2 text-xs font-bold outline-none">
                        <option>Solid Machined</option>
                        <option>Fabricated</option>
                      </select>
                    </div>

                    <div className="space-y-1">
                      <label className="text-[9px] text-gray-500 uppercase font-bold">Material</label>
                       <select value={config.accessories.thermowell.material} onChange={(e) => updateAccessory('thermowell', 'material', e.target.value)} className="w-full bg-[#0f0f11] border border-white/10 rounded-lg p-2 text-xs font-bold outline-none">
                        {wellMaterials.map(m => <option key={m}>{m}</option>)}
                      </select>
                    </div>

                    <div className="space-y-1">
                      <label className="text-[9px] text-gray-500 uppercase font-bold">Process Thread</label>
                       <select value={config.accessories.thermowell.processConnection} onChange={(e) => updateAccessory('thermowell', 'processConnection', e.target.value)} className="w-full bg-[#0f0f11] border border-white/10 rounded-lg p-2 text-xs font-bold outline-none">
                        {connectionStandards.map(m => <option key={m}>{m}</option>)}
                      </select>
                    </div>
                  </div>
                )}
              </div>
            </div>
          </section>

          {/* Other Technical Params Section */}
          <section className="bg-[#16161a] p-6 rounded-3xl shadow-xl border border-white/5">
            <h2 className="text-xs font-black mb-4 uppercase tracking-widest text-pink-400 flex items-center gap-2">
              <ScrollText size={16} /> Other Parameters
            </h2>
            <textarea
              value={config.otherTechnicalParams}
              onChange={(e) => updateConfig('otherTechnicalParams', e.target.value)}
              className="w-full h-32 bg-[#1c1c21] border border-white/5 rounded-xl p-3 outline-none focus:ring-2 focus:ring-pink-500/50 text-xs font-mono text-gray-300 resize-none leading-relaxed"
            />
          </section>

          {/* Options */}
          <section className="bg-[#16161a] p-6 rounded-3xl shadow-xl border border-white/5">
             <h2 className="text-xs font-black mb-4 uppercase tracking-widest text-purple-400 flex items-center gap-2">
              <Settings size={16} /> Options
            </h2>
            <div className="space-y-2">
              <button onClick={() => toggleOption('redPointer')} className={`w-full flex items-center justify-between p-3 rounded-xl border text-xs font-bold transition-all ${config.options.redPointer ? 'bg-purple-600/20 border-purple-500 text-purple-300' : 'bg-[#1c1c21] border-white/5 text-gray-500'}`}>
                <span>Red Set Pointer</span>
                {config.options.redPointer ? <CheckCircle2 size={16}/> : <div className="w-4 h-4 rounded-full border border-gray-600"></div>}
              </button>
               <button onClick={() => toggleOption('calibrationCert')} className={`w-full flex items-center justify-between p-3 rounded-xl border text-xs font-bold transition-all ${config.options.calibrationCert ? 'bg-purple-600/20 border-purple-500 text-purple-300' : 'bg-[#1c1c21] border-white/5 text-gray-500'}`}>
                <span>Calibration Certificate</span>
                {config.options.calibrationCert ? <CheckCircle2 size={16}/> : <div className="w-4 h-4 rounded-full border border-gray-600"></div>}
              </button>
            </div>
          </section>

        </div>

        {/* Right Column: Visualization */}
        <div className="lg:col-span-7 space-y-6">
          <div id="blueprint-capture-area" ref={previewRef} className="bg-white p-6 md:p-12 rounded-[48px] shadow-2xl flex flex-col items-center justify-center min-h-[600px] md:min-h-[750px] relative overflow-hidden border border-gray-100">
            <div className="absolute top-10 left-12 text-[10px] text-gray-400 uppercase tracking-[0.4em] font-black">Industrial Configurator - Preview</div>
            
            {/* Dynamic SVG */}
            <svg width="100%" height="600" viewBox="0 0 600 600" preserveAspectRatio="xMidYMid meet">
              <defs>
                <linearGradient id="caseGrad" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0%" stopColor="#e0e0e0" />
                  <stop offset="40%" stopColor="#f5f5f5" />
                  <stop offset="100%" stopColor="#d4d4d4" />
                </linearGradient>
                <linearGradient id="stemGrad" x1="0" y1="0" x2="1" y2="0">
                  <stop offset="0%" stopColor="#999" />
                  <stop offset="50%" stopColor="#e0e0e0" />
                  <stop offset="100%" stopColor="#888" />
                </linearGradient>
                 <linearGradient id="wellGrad" x1="0" y1="0" x2="1" y2="0">
                  <stop offset="0%" stopColor="#777" />
                  <stop offset="50%" stopColor="#d0d0d0" />
                  <stop offset="100%" stopColor="#666" />
                </linearGradient>
                <filter id="dropshadow" height="130%">
                  <feGaussianBlur in="SourceAlpha" stdDeviation="3"/> 
                  <feOffset dx="2" dy="2" result="offsetblur"/> 
                  <feComponentTransfer>
                    <feFuncA type="linear" slope="0.3"/> 
                  </feComponentTransfer>
                  <feMerge> 
                    <feMergeNode/>
                    <feMergeNode in="SourceGraphic"/> 
                  </feMerge>
                </filter>
              </defs>

              <g transform={`translate(${visual.cx}, ${visual.cy})`}>
                
                {/* STEM Visualization (Lower OR Adjustable) */}
                {(config.connection.location === 'Lower' || config.connection.location === 'Adjustable') && (
                   <g transform={`translate(0, ${visual.r})`}>
                     
                     {/* If Adjustable, draw the Pivot Joint (Knuckle) */}
                     {config.connection.location === 'Adjustable' && (
                        <g>
                           {/* Main pivot block */}
                           <rect x="-18" y="0" width="36" height="25" rx="4" fill="#ccc" stroke="#888" />
                           {/* Bolt/Hinge visual */}
                           <circle cx="0" cy="12.5" r="5" fill="#aaa" stroke="#777" />
                           <rect x="-2" y="12.5" width="4" height="12" fill="#999" opacity="0.5"/>
                        </g>
                     )}

                     {/* Main Stem Group - Shift down if Adjustable */}
                     <g transform={`translate(0, ${visual.knuckleHeight})`}>
                         {/* Conditionally Render Connection Design OR Thermowell */}
                         {config.accessories.thermowell.enabled ? (
                            <g transform="translate(0, 35)">
                               {/* Thermowell Drawing Override */}
                               <rect x={-visual.wellWidth/2} y="0" width={visual.wellWidth} height="20" fill="#bbb" stroke="#666" />
                               {config.accessories.thermowell.design === 'Tapered' ? (
                                 <path d={`M -${visual.wellWidth/2} 20 L -${visual.wellWidth/3} ${visual.stemLen} L ${visual.wellWidth/3} ${visual.stemLen} L ${visual.wellWidth/2} 20 Z`} fill="url(#wellGrad)" stroke="#666" />
                               ) : (
                                 <rect x={-visual.wellWidth/2} y="20" width={visual.wellWidth} height={visual.stemLen} fill="url(#wellGrad)" stroke="#666" />
                               )}
                               <line x1={-visual.wellWidth/2} y1="10" x2={visual.wellWidth/2} y2="10" stroke="#555" strokeWidth="0.5"/>
                            </g>
                         ) : (
                            // Standard Connections
                            <ConnectionDrawing type={config.connection.design} visual={visual} />
                         )}
                     </g>
                   </g>
                )}

                {/* Main Case Body */}
                <circle r={visual.r} fill="url(#caseGrad)" stroke="#999" strokeWidth="1" filter="url(#dropshadow)" />
                <circle r={visual.rInner} fill="none" stroke="#b0b0b0" strokeWidth="4" />
                <circle r={visual.rDial} fill="#fff" />

                {/* Liquid Filling Simulation */}
                {config.case.filling !== 'Dry' && (
                   <circle r={visual.rDial} fill="rgba(200, 200, 250, 0.1)" />
                )}

                {/* Scale Ticks & Numbers */}
                <ScaleTicks r={visual.rDial} min={config.rangeMin} max={config.rangeMax} />

                {/* Labels */}
                <text 
                  y={-visual.rDial * 0.4} 
                  textAnchor="middle" 
                  className={`font-black tracking-widest fill-gray-800 ${config.nominalSize === 63 ? 'text-[7px]' : 'text-xs md:text-sm'}`}
                >
                  EN 13190
                </text>
                
                <text y={visual.rDial * 0.5} textAnchor="middle" className={`font-bold fill-gray-600 ${config.nominalSize === 63 ? 'text-sm' : 'text-lg'}`}>{config.unit}</text>
                <text y={visual.rDial * 0.65} textAnchor="middle" className="font-bold text-[8px] fill-gray-400">Class 1</text>
                
                {/* Tag */}
                {config.project.tagNumber && (
                  <text y={visual.rDial * 0.25} textAnchor="middle" className="font-mono font-bold text-[10px] fill-red-600 uppercase tracking-tight">
                    {config.project.tagNumber}
                  </text>
                )}

                {/* Red Set Pointer */}
                {config.options.redPointer && (
                  <g transform="rotate(120)">
                    {/* Dynamic sizing based on dial radius to fit NS63 and NS100+ correctly */}
                    <polygon 
                      points={`
                        0,-10 
                        ${config.nominalSize === 63 ? 2.5 : 4},-${visual.rDial * 0.85} 
                        0,-${visual.rDial * 0.92} 
                        -${config.nominalSize === 63 ? 2.5 : 4},-${visual.rDial * 0.85}
                      `} 
                      fill="red" 
                      opacity="0.9" 
                    />
                  </g>
                )}

                {/* Main Pointer (Black) */}
                <g transform="rotate(-40)" filter="url(#dropshadow)">
                   <circle r="6" fill="#000" />
                   <path d={`M -2 0 L -1 -${visual.rDial * 0.9} L 1 -${visual.rDial * 0.9} L 2 0 Z`} fill="#000" />
                   <path d="M -3 0 L -4 15 L 4 15 L 3 0 Z" fill="#000" />
                </g>

                <circle r="2.5" fill="#aaa" />

              </g>

              {/* Back Mount Representation (Ghosted) */}
              {config.connection.location === 'Back' && (
                <g>
                  <text x="500" y="550" textAnchor="end" className="text-sm fill-gray-400 font-mono">* BACK CONNECTION VIEW</text>
                  <circle cx={visual.cx} cy={visual.cy} r={visual.r * 0.3} fill="none" stroke="#ddd" strokeWidth="2" strokeDasharray="4 4" />
                </g>
              )}
            </svg>

            <div className="absolute bottom-10 right-12 flex items-center gap-2 text-red-500/40 font-black text-[10px] pointer-events-none">
              <ExternalLink size={12} /> cadautoscript.com
            </div>
            
            <div className="absolute bottom-10 left-12 flex flex-col gap-1 text-gray-300 font-mono text-[10px]">
               <div>NS: {config.nominalSize}mm</div>
               <div>RANGE: {config.rangeMin}..{config.rangeMax} {config.unit}</div>
               <div>STEM: L={config.stem.length}mm d={config.stem.diameter}mm</div>
               <div className="text-purple-400 font-bold">LOC: {config.connection.location.toUpperCase()}</div>
               {config.accessories.thermowell.enabled ? (
                 <div className="text-cyan-400 font-bold">
                    + THERMOWELL U={config.accessories.thermowell.insertionLength}mm
                 </div>
               ) : (
                  <div className="text-green-400 font-bold text-[9px] mt-1">
                     DESIGN: {config.connection.design.toUpperCase()}
                  </div>
               )}
            </div>
          </div>
        </div>
      </div>

      <style>{`
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #444; }
      `}</style>
    </div>
  );
};

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
  </script>
</body>

</html>
