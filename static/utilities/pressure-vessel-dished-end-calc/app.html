<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Dished End (Vessel Head) Calculator</title>
  <script src="../../vendor/react.production.min.js"></script>
  <script src="../../vendor/react-dom.production.min.js"></script>
  <script src="../../vendor/babel.min.js"></script>
  <script src="../../vendor/tailwindcss.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['system-ui', '-apple-system', 'Segoe UI', 'Roboto', 'sans-serif'],
            serif: ['ui-serif', 'Georgia', 'serif'],
          },
        },
      },
    };
  </script>
  <style>
    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      background: #0a0a0a;
    }

    .custom-scrollbar::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.06);
      border-radius: 10px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: rgba(96, 165, 250, 0.45);
      border-radius: 10px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: rgba(96, 165, 250, 0.65);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(4px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fadeIn {
      animation: fadeIn 0.18s ease-out both;
    }

    .pvde-pattern {
      background-color: #0f172a;
      background-image:
        radial-gradient(60rem 20rem at 20% 10%, rgba(59, 130, 246, 0.22), transparent 55%),
        radial-gradient(50rem 18rem at 85% 20%, rgba(14, 165, 233, 0.15), transparent 60%),
        radial-gradient(40rem 18rem at 45% 85%, rgba(148, 163, 184, 0.1), transparent 55%);
    }

    @media print {
      html,
      body {
        background: #fff !important;
      }
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useMemo, useRef, useState } = React;

    const APP_VERSION = '0.1.3b';

    const ICONS = {
      download: [
        'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4',
        'M7 10l5 5 5-5',
        'M12 15V3',
      ].join(''),
      settings: [
        'M12 15.5a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7.5z',
        'M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 8.1 19.4 1.65 1.65 0 0 0 6.28 19l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 3.67 15a1.65 1.65 0 0 0-1.51-1H2a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 3.6 8.6 1.65 1.65 0 0 0 3.67 7l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 8 3.67 1.65 1.65 0 0 0 9.51 2H10a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9c.35 0 .69.07 1 .2h.09a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1 1.51z',
      ].join(''),
      plus: ['M12 5v14', 'M5 12h14'].join(''),
      'trash-2': [
        'M3 6h18',
        'M8 6v12a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6',
        'M10 6V4a2 2 0 0 1 2-2h0a2 2 0 0 1 2 2v2',
        'M10 11v6',
        'M14 11v6',
      ].join(''),
      x: ['M18 6 6 18', 'M6 6l12 12'].join(''),
      info: ['M12 9v4', 'M12 17h.01', 'M22 12A10 10 0 1 1 2 12a10 10 0 0 1 20 0Z'].join(''),
      printer: [
        'M6 9V2h12v7',
        'M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2',
        'M6 14h12v8H6v-8z',
      ].join(''),
      ruler:
        'M21.3 8.7 8.7 21.3a2.12 2.12 0 0 1-3 0l-3-3a2.12 2.12 0 0 1 0-3L15.3 2.7a2.12 2.12 0 0 1 3 0l3 3a2.12 2.12 0 0 1 0 3Z',
      layers: ['M12 2 2 7l10 5 10-5-10-5z', 'M2 17l10 5 10-5', 'M2 12l10 5 10-5'].join(''),
      scissors: [
        'M20 4 8.5 15.5',
        'M8.5 8.5 20 20',
        'M6 6a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm0 12a2 2 0 1 1-4 0 2 2 0 0 1 4 0z',
      ].join(''),
      cpu: null,
    };

    const CpuIcon = () => (
      <>
        <rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect>
        <rect x="9" y="9" width="6" height="6"></rect>
        <path d="M9 1v3M15 1v3M9 20v3M15 20v3M20 9h3M20 14h3M1 9h3M1 14h3"></path>
      </>
    );

    const Icon = ({ name, size = 18, className = '' }) => {
      if (name === 'cpu') {
        return (
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width={size}
            height={size}
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
            className={className}
            aria-hidden="true"
          >
            <CpuIcon />
          </svg>
        );
      }

      const d = ICONS[name];
      if (!d) return null;
      return (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
          aria-hidden="true"
        >
          <path d={d}></path>
        </svg>
      );
    };

    const MATERIALS = [
      'P265GH (1.0425)',
      'P295GH (1.0481)',
      '16Mo3 (1.5415)',
      'P355NH (1.0565)',
      'Stainless 304L (1.4307)',
      'Stainless 316L (1.4404)',
      'Duplex 2205 (1.4462)',
      'Titanium Gr.2',
    ];

    const NOZZLE_SIZES = ['DN15', 'DN25', 'DN40', 'DN50', 'DN80', 'DN100', 'DN150', 'DN200', 'DN300', 'DN400', 'DN500'];

    const getTolerances = (Da) => {
      let daTol = 0;
      if (Da <= 500) daTol = 2;
      else if (Da <= 1200) daTol = 3;
      else if (Da <= 2000) daTol = 4;
      else daTol = Math.ceil(Da * 0.003);

      return {
        daPlus: daTol,
        daMinus: daTol,
        hPlus: 10,
        hMinus: 0,
        ovality: Math.ceil(Da * 0.01),
        thicknessMin: 0.3,
      };
    };

    const calculateGeometry = (config) => {
      const { diameterOuter: Da, thickness: s, standard, straightFlange: h1 } = config;

      let R = 0;
      let r = 0;
      let h2 = 0;
      let blankDiameterFactor = 1.0;

      if (standard === 'DIN28011') {
        R = Da;
        r = 0.1 * Da;
        h2 = 0.1935 * Da - 0.455 * s;
        blankDiameterFactor = 1.09;
      } else if (standard === 'DIN28013') {
        R = 0.8 * Da;
        r = 0.154 * Da;
        h2 = 0.255 * Da - 0.635 * s;
        blankDiameterFactor = 1.14;
      } else if (standard === 'SS895') {
        R = Da;
        r = 0.1 * Da;
        h2 = 0.1935 * Da;
        blankDiameterFactor = 1.09;
      }

      const totalHeight = h1 + h2 + s;

      const blankDiameter = blankDiameterFactor * Da + 2 * h1;
      const surfaceAreaMM2 = Math.PI * (blankDiameter / 2) ** 2;
      const volumeMM3 = surfaceAreaMM2 * s;

      const density = config.material.includes('Stainless') ? 7.9 : 7.85;
      const weight = (volumeMM3 / 1000000) * density;

      return { R, r, h2, totalHeight, weight, blankDiameter, tolerances: getTolerances(Da) };
    };

    const SvgDimension = ({ x1, y1, x2, y2, text, offset = 10, color = 'black', fontSize = 14, orientation = 'horizontal' }) => {
      const arrowSize = fontSize / 2.5;

      let lx1 = x1,
        ly1 = y1,
        lx2 = x2,
        ly2 = y2;
      let tx = (x1 + x2) / 2;
      let ty = (y1 + y2) / 2;

      if (orientation === 'horizontal') {
        ly1 += offset;
        ly2 += offset;
        ty = ly1 - fontSize * 0.3;
      } else {
        lx1 += offset;
        lx2 += offset;
        tx = lx1 + fontSize * 0.3;
        if (offset < 0) tx = lx1 - fontSize * 0.8;
      }

      return (
        <g className="dimension-line">
          <line x1={x1} y1={y1} x2={lx1} y2={ly1} stroke={color} strokeWidth="0.5" opacity="0.5" />
          <line x1={x2} y1={y2} x2={lx2} y2={ly2} stroke={color} strokeWidth="0.5" opacity="0.5" />
          <line x1={lx1} y1={ly1} x2={lx2} y2={ly2} stroke={color} strokeWidth="1" />
          {orientation === 'horizontal' ? (
            <>
              <path
                d={`M ${lx1} ${ly1} L ${lx1 + arrowSize} ${ly1 - arrowSize / 2} L ${lx1 + arrowSize} ${ly1 + arrowSize / 2} Z`}
                fill={color}
              />
              <path
                d={`M ${lx2} ${ly2} L ${lx2 - arrowSize} ${ly2 - arrowSize / 2} L ${lx2 - arrowSize} ${ly2 + arrowSize / 2} Z`}
                fill={color}
              />
            </>
          ) : (
            <>
              <path
                d={`M ${lx1} ${ly1} L ${lx1 - arrowSize / 2} ${ly1 + arrowSize} L ${lx1 + arrowSize / 2} ${ly1 + arrowSize} Z`}
                fill={color}
              />
              <path
                d={`M ${lx2} ${ly2} L ${lx2 - arrowSize / 2} ${ly2 - arrowSize} L ${lx2 + arrowSize / 2} ${ly2 - arrowSize} Z`}
                fill={color}
              />
            </>
          )}
          <text
            x={tx}
            y={ty}
            fill={color}
            fontSize={fontSize}
            textAnchor="middle"
            dominantBaseline={orientation === 'horizontal' ? 'auto' : 'middle'}
            fontWeight="bold"
            style={{
              paintOrder: 'stroke',
              stroke: color === 'black' ? 'white' : 'black',
              strokeWidth: '3px',
              strokeLinecap: 'butt',
              strokeLinejoin: 'miter',
              strokeOpacity: 0.3,
            }}
          >
            {text}
          </text>
        </g>
      );
    };

    function PressureVesselDishedEndCalc() {
      const [config, setConfig] = useState({
        standard: 'DIN28011',
        diameterOuter: 1000,
        thickness: 8,
        straightFlange: 25,
        material: 'P265GH (1.0425)',
        pressure: 10,
        temp: 20,
        corrosionAllowance: 1,
        edgePrep: 'None',
        bevelAngle: 30,
        rootFace: 2,
      });

      const [nozzles, setNozzles] = useState([]);
      const [showReport, setShowReport] = useState(false);
      const svgRef = useRef(null);

      const handleStandardChange = (standard) => setConfig((prev) => ({ ...prev, standard }));

      const addNozzle = () => {
        const newNozzle = { id: Math.random().toString(36).slice(2, 11), size: 'DN50', offset: 0, type: 'PN16' };
        setNozzles((prev) => [...prev, newNozzle]);
      };

      const removeNozzle = (id) => setNozzles((prev) => prev.filter((nozzle) => nozzle.id !== id));

      const updateNozzle = (id, field, value) => {
        setNozzles((prev) => prev.map((nozzle) => (nozzle.id === id ? { ...nozzle, [field]: value } : nozzle)));
      };

      const generatePDF = () => {
        setShowReport(true);
        setTimeout(() => {
          try {
            window.print();
          } catch (e) {
            console.log('Auto-print blocked');
          }
        }, 100);
      };

      const calculated = useMemo(() => calculateGeometry(config), [config]);

      const screenViewBoxSize = config.diameterOuter * 1.5;
      const center = screenViewBoxSize / 2;
      const printPaddingX = config.diameterOuter * 0.25;
      const printPaddingY = config.diameterOuter * 0.2;
      const printWidth = config.diameterOuter + printPaddingX * 2;
      const printHeight = calculated.totalHeight + printPaddingY * 2;
      const printMinX = center - printWidth / 2;
      const printMinY = center - calculated.totalHeight / 2 - printPaddingY;
      const printViewBox = `${printMinX} ${printMinY} ${printWidth} ${printHeight}`;
      const printFontSize = Math.max(24, config.diameterOuter * 0.035);

      const drawHeadProfile = (isPrint = false) => {
        const width = config.diameterOuter;
        const height = calculated.totalHeight;
        const sf = config.straightFlange;
        const t = config.thickness;

        const fill = isPrint ? 'none' : 'url(#metalGradient)';
        const stroke = isPrint ? 'black' : '#60a5fa';
        const strokeWidth = isPrint ? Math.max(2, config.diameterOuter / 400) : 2;
        const dimColor = isPrint ? 'black' : '#cbd5e1';

        const bevelW =
          config.edgePrep === 'V-Bevel'
            ? Math.tan((config.bevelAngle * Math.PI) / 180) * (t - config.rootFace)
            : 0;
        const root = config.edgePrep !== 'None' ? config.rootFace : t;

        return (
          <g>
            <path
              d={`
                M ${center - width / 2} ${center + height / 2}
                L ${center - width / 2} ${center + height / 2 - sf}
                C ${center - width / 2} ${center - height / 2} ${center + width / 2} ${center - height / 2} ${center + width / 2} ${center + height / 2 - sf}
                L ${center + width / 2} ${center + height / 2}
                ${
                  config.edgePrep === 'V-Bevel'
                    ? `
                      L ${center + width / 2 - root} ${center + height / 2}
                      L ${center + width / 2 - t} ${center + height / 2 - bevelW}
                    `
                    : `
                      L ${center + width / 2 - t} ${center + height / 2}
                    `
                }
                L ${center + width / 2 - t} ${center + height / 2 - sf}
                C ${center + width / 2 - t} ${center - height / 2 + t} ${center - width / 2 + t} ${center - height / 2 + t} ${center - width / 2 + t} ${center + height / 2 - sf}
                ${
                  config.edgePrep === 'V-Bevel'
                    ? `
                      L ${center - width / 2 + t} ${center + height / 2 - bevelW}
                      L ${center - width / 2 + root} ${center + height / 2}
                    `
                    : `
                      L ${center - width / 2 + t} ${center + height / 2}
                    `
                }
                Z
              `}
              fill={fill}
              stroke={stroke}
              strokeWidth={strokeWidth}
              strokeLinejoin="round"
            />

            <g className="dimensions">
              <line
                x1={center}
                y1={center - height / 2 - printFontSize}
                x2={center}
                y2={center + height / 2 + printFontSize}
                stroke={dimColor}
                strokeWidth="1"
                strokeDasharray={`${printFontSize},${printFontSize / 2}`}
                opacity="0.5"
              />

              <SvgDimension
                x1={center - width / 2}
                y1={center + height / 2}
                x2={center + width / 2}
                y2={center + height / 2}
                text={`Da = ${config.diameterOuter}`}
                offset={printFontSize * 2.5}
                fontSize={printFontSize}
                orientation="horizontal"
                color={dimColor}
              />

              <SvgDimension
                x1={center + width / 2}
                y1={center - height / 2 + t}
                x2={center + width / 2}
                y2={center + height / 2}
                text={`H = ${calculated.totalHeight.toFixed(1)}`}
                offset={printFontSize * 3}
                fontSize={printFontSize}
                orientation="vertical"
                color={dimColor}
              />

              <SvgDimension
                x1={center - width / 2}
                y1={center + height / 2 - sf}
                x2={center - width / 2}
                y2={center + height / 2}
                text={`h1 = ${config.straightFlange}`}
                offset={-printFontSize * 2.5}
                fontSize={printFontSize}
                orientation="vertical"
                color={dimColor}
              />

              <g>
                <line
                  x1={center + width / 2 - t / 2}
                  y1={center + height / 2 - sf / 2}
                  x2={center + width / 2 + printFontSize * 4}
                  y2={center + height / 2 - sf / 2}
                  stroke={dimColor}
                  strokeWidth="1"
                />
                <text
                  x={center + width / 2 + printFontSize * 4.5}
                  y={center + height / 2 - sf / 2 + printFontSize * 0.35}
                  fontSize={printFontSize}
                  fontWeight="bold"
                  fill={dimColor}
                >
                  s = {config.thickness}
                </text>
                <circle
                  cx={center + width / 2 - t / 2}
                  cy={center + height / 2 - sf / 2}
                  r={printFontSize / 5}
                  fill={dimColor}
                />
              </g>

              {config.edgePrep !== 'None' ? (
                <g>
                  <line
                    x1={center + width / 2}
                    y1={center + height / 2}
                    x2={center + width / 2 + printFontSize * 2}
                    y2={center + height / 2 + printFontSize * 2}
                    stroke={dimColor}
                    strokeWidth="1"
                  />
                  <text
                    x={center + width / 2 + printFontSize * 2.2}
                    y={center + height / 2 + printFontSize * 2.2}
                    fontSize={printFontSize * 0.8}
                    fontWeight="bold"
                    fill={dimColor}
                  >
                    {config.edgePrep}: {config.bevelAngle}Å³
                  </text>
                </g>
              ) : null}
            </g>
          </g>
        );
      };

      const volumeM3 = useMemo(() => {
        const cylinderApprox = calculated.totalHeight * Math.PI * (config.diameterOuter / 2) ** 2;
        return (cylinderApprox / 1e9) * 0.7;
      }, [calculated.totalHeight, config.diameterOuter]);

      return (
        <>
          <div
            className={`min-h-screen bg-neutral-900 text-neutral-200 font-sans selection:bg-blue-500/30 print:hidden ${
              showReport ? 'hidden' : 'block'
            }`}
          >
            <header className="bg-neutral-800 border-b border-neutral-700 sticky top-0 z-20 shadow-lg">
              <div className="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="bg-blue-600 p-2 rounded-lg">
                    <Icon name="layers" size={22} className="text-white" />
                  </div>
                  <div>
                    <h1 className="text-xl font-bold text-white tracking-tight flex items-baseline gap-2">
                      <span>
                        VesselHead<span className="text-blue-500">Config</span>
                      </span>
                      <span className="text-xs font-mono text-neutral-500 bg-neutral-900/50 px-1.5 py-0.5 rounded border border-neutral-700/50">
                        v{APP_VERSION}
                      </span>
                    </h1>
                    <p className="text-xs text-neutral-400">DIN 28011 / 28013 / SS 895 Calculator</p>
                  </div>
                </div>
                <div className="flex items-center gap-4">
                  <button
                    onClick={generatePDF}
                    className="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-full font-medium transition-all shadow-lg shadow-blue-900/20 active:scale-95"
                  >
                    <Icon name="download" size={18} />
                    <span>QC Report (PDF)</span>
                  </button>
                </div>
              </div>
            </header>

            <main className="max-w-7xl mx-auto p-4 lg:p-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
              <div className="lg:col-span-4 space-y-6">
                <div className="bg-neutral-800 rounded-2xl p-6 border border-neutral-700 shadow-xl">
                  <h2 className="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                    <Icon name="ruler" size={20} className="text-blue-500" /> Standard
                  </h2>
                  <div className="grid grid-cols-3 gap-2">
                    {['DIN28011', 'DIN28013', 'SS895'].map((std) => (
                      <button
                        key={std}
                        onClick={() => handleStandardChange(std)}
                        className={`py-2 px-3 text-xs md:text-sm rounded-lg border font-medium transition-all ${
                          config.standard === std
                            ? 'bg-blue-600 border-blue-500 text-white shadow-lg'
                            : 'bg-neutral-900 border-neutral-700 text-neutral-400 hover:border-neutral-500'
                        }`}
                      >
                        {std}
                      </button>
                    ))}
                  </div>
                </div>

                <div className="bg-neutral-800 rounded-2xl p-6 border border-neutral-700 shadow-xl">
                  <h2 className="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                    <Icon name="settings" size={20} className="text-blue-500" /> Geometry &amp; Material
                  </h2>

                  <div className="space-y-4">
                    <div className="grid grid-cols-2 gap-4">
                      <div className="group">
                        <label className="block text-xs text-neutral-400 mb-1 ml-1">Diameter (Da)</label>
                        <input
                          type="number"
                          value={config.diameterOuter}
                          onChange={(e) => setConfig({ ...config, diameterOuter: Number(e.target.value) })}
                          className="w-full bg-neutral-900 border border-neutral-700 rounded-lg py-2.5 px-3 text-white focus:ring-2 focus:ring-blue-600 outline-none"
                        />
                      </div>

                      <div className="group">
                        <label className="block text-xs text-neutral-400 mb-1 ml-1">Thickness (s)</label>
                        <input
                          type="number"
                          value={config.thickness}
                          onChange={(e) => setConfig({ ...config, thickness: Number(e.target.value) })}
                          className="w-full bg-neutral-900 border border-neutral-700 rounded-lg py-2.5 px-3 text-white focus:ring-2 focus:ring-blue-600 outline-none"
                        />
                      </div>
                    </div>

                    <div className="group">
                      <label className="block text-xs text-neutral-400 mb-1 ml-1">
                        Straight Flange (h1): {config.straightFlange} mm
                      </label>
                      <input
                        type="range"
                        min="10"
                        max="150"
                        step="5"
                        value={config.straightFlange}
                        onChange={(e) => setConfig({ ...config, straightFlange: Number(e.target.value) })}
                        className="w-full h-2 bg-neutral-900 rounded-lg appearance-none cursor-pointer accent-blue-600"
                      />
                    </div>

                    <div className="group">
                      <label className="block text-xs text-neutral-400 mb-1 ml-1">Material</label>
                      <select
                        value={config.material}
                        onChange={(e) => setConfig({ ...config, material: e.target.value })}
                        className="w-full bg-neutral-900 border border-neutral-700 rounded-lg py-2.5 px-3 text-white focus:ring-2 focus:ring-blue-600 outline-none"
                      >
                        {MATERIALS.map((m) => (
                          <option key={m} value={m}>
                            {m}
                          </option>
                        ))}
                      </select>
                    </div>
                  </div>
                </div>

                <div className="bg-neutral-800 rounded-2xl p-6 border border-neutral-700 shadow-xl">
                  <h2 className="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                    <Icon name="scissors" size={20} className="text-blue-500" /> Weld Edge Prep
                  </h2>
                  <div className="space-y-4">
                    <div className="group">
                      <label className="block text-xs text-neutral-400 mb-1 ml-1">Type</label>
                      <select
                        value={config.edgePrep}
                        onChange={(e) => setConfig({ ...config, edgePrep: e.target.value })}
                        className="w-full bg-neutral-900 border border-neutral-700 rounded-lg py-2.5 px-3 text-white focus:ring-2 focus:ring-blue-600 outline-none"
                      >
                        <option value="None">None (Square Cut)</option>
                        <option value="V-Bevel">V-Bevel (Outside)</option>
                      </select>
                    </div>
                    {config.edgePrep !== 'None' ? (
                      <div className="grid grid-cols-2 gap-4 animate-fadeIn">
                        <div>
                          <label className="block text-xs text-neutral-400 mb-1">Angle (u)</label>
                          <input
                            type="number"
                            value={config.bevelAngle}
                            onChange={(e) => setConfig({ ...config, bevelAngle: Number(e.target.value) })}
                            className="w-full bg-neutral-900 border border-neutral-700 rounded-lg py-2 px-3 text-white"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-neutral-400 mb-1">Root Face (mm)</label>
                          <input
                            type="number"
                            value={config.rootFace}
                            onChange={(e) => setConfig({ ...config, rootFace: Number(e.target.value) })}
                            className="w-full bg-neutral-900 border border-neutral-700 rounded-lg py-2 px-3 text-white"
                          />
                        </div>
                      </div>
                    ) : null}
                  </div>
                </div>

                <div className="bg-neutral-800 rounded-2xl p-6 border border-neutral-700 shadow-xl">
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-lg font-semibold text-white flex items-center gap-2">
                      <Icon name="cpu" size={20} className="text-blue-500" /> Nozzles
                    </h2>
                    <button
                      onClick={addNozzle}
                      className="p-1.5 bg-blue-600/20 text-blue-400 rounded-lg hover:bg-blue-600 hover:text-white transition-colors"
                      aria-label="Add nozzle"
                    >
                      <Icon name="plus" size={18} />
                    </button>
                  </div>
                  <div className="space-y-3 max-h-40 overflow-y-auto pr-1 custom-scrollbar">
                    {nozzles.map((nozzle) => (
                      <div
                        key={nozzle.id}
                        className="bg-neutral-900 p-3 rounded-lg border border-neutral-700 flex gap-2 items-end"
                      >
                        <div className="flex-1">
                          <select
                            value={nozzle.size}
                            onChange={(e) => updateNozzle(nozzle.id, 'size', e.target.value)}
                            className="w-full bg-neutral-800 border border-neutral-700 text-xs rounded p-1.5"
                          >
                            {NOZZLE_SIZES.map((s) => (
                              <option key={s} value={s}>
                                {s}
                              </option>
                            ))}
                          </select>
                        </div>
                        <div className="flex-1">
                          <input
                            type="number"
                            value={nozzle.offset}
                            onChange={(e) => updateNozzle(nozzle.id, 'offset', Number(e.target.value))}
                            className="w-full bg-neutral-800 border border-neutral-700 text-xs rounded p-1.5"
                          />
                        </div>
                        <button
                          onClick={() => removeNozzle(nozzle.id)}
                          className="p-1.5 text-red-400 hover:bg-red-400/10 rounded"
                          aria-label="Remove nozzle"
                        >
                          <Icon name="trash-2" size={16} />
                        </button>
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              <div className="lg:col-span-8 flex flex-col gap-6">
                <div className="flex-1 bg-neutral-800 rounded-2xl border border-neutral-700 shadow-2xl overflow-hidden relative min-h-[500px] flex flex-col">
                  <div className="flex-1 flex items-center justify-center p-8 pvde-pattern">
                    <svg
                      ref={svgRef}
                      viewBox={`0 0 ${screenViewBoxSize} ${screenViewBoxSize}`}
                      className="w-full h-full max-h-[600px]"
                    >
                      <defs>
                        <linearGradient id="metalGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                          <stop offset="0%" stopColor="#374151" />
                          <stop offset="50%" stopColor="#4b5563" />
                          <stop offset="100%" stopColor="#374151" />
                        </linearGradient>
                      </defs>
                      <line x1={center} y1="0" x2={center} y2={screenViewBoxSize} stroke="#333" strokeDasharray="10,10" />
                      <line x1="0" y1={center} x2={screenViewBoxSize} y2={center} stroke="#333" strokeDasharray="10,10" />
                      {drawHeadProfile(false)}
                      {nozzles.map((n, i) => {
                        const nW = parseInt(n.size.replace('DN', ''), 10) || 50;
                        const nVisualW = Math.max(20, nW);
                        const nH = 60;
                        const nX = center + n.offset;
                        const nY = center - calculated.totalHeight / 2 + config.thickness + 10;
                        return (
                          <g key={n.id}>
                            <rect
                              x={nX - nVisualW / 2}
                              y={nY - nH}
                              width={nVisualW}
                              height={nH}
                              fill="#ef4444"
                              stroke="white"
                              strokeWidth="1"
                            />
                            <text
                              x={nX}
                              y={nY - nH - 10}
                              textAnchor="middle"
                              fill="#ef4444"
                              fontSize="20"
                              fontWeight="bold"
                            >
                              N{i + 1}
                            </text>
                          </g>
                        );
                      })}
                    </svg>
                  </div>
                  <div className="h-20 bg-neutral-800 border-t border-neutral-700 flex items-center justify-around px-4">
                    <div className="text-center">
                      <div className="text-xs text-neutral-500 uppercase">Volume</div>
                      <div className="text-xl font-mono text-white">{volumeM3.toFixed(3)} m3</div>
                    </div>
                    <div className="h-10 w-px bg-neutral-700"></div>
                    <div className="text-center">
                      <div className="text-xs text-neutral-500 uppercase">Weight</div>
                      <div className="text-xl font-mono text-blue-400">{calculated.weight.toFixed(1)} kg</div>
                    </div>
                  </div>
                </div>
              </div>
            </main>
          </div>
          <div
            className={`${
              showReport ? 'fixed inset-0 z-50 overflow-y-auto' : 'hidden'
            } print:block print:static print:overflow-visible bg-white text-black p-8 font-serif w-full h-full`}
          >
            <div className="print:hidden mb-6 flex justify-between items-center bg-gray-100 p-4 rounded-lg shadow-sm">
              <div className="flex items-center gap-2 text-sm text-gray-700">
                <Icon name="info" size={18} className="text-blue-600" />
                <span>
                  Press <b>Ctrl+P</b> to print.
                </span>
              </div>
              <div className="flex gap-3">
                <button
                  onClick={() => {
                    try {
                      window.print();
                    } catch (e) {}
                  }}
                  className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md text-sm"
                >
                  <Icon name="printer" size={16} /> Print
                </button>
                <button
                  onClick={() => setShowReport(false)}
                  className="flex items-center gap-2 px-4 py-2 bg-white border text-gray-700 rounded-md text-sm"
                >
                  <Icon name="x" size={16} /> Close
                </button>
              </div>
            </div>

            <div className="max-w-[210mm] mx-auto bg-white min-h-[290mm]">
              <div className="border-b-2 border-black pb-4 mb-6 flex justify-between items-end">
                <div>
                  <h1 className="text-3xl font-bold uppercase tracking-wider">Manufacturing Report</h1>
                  <h2 className="text-xl mt-1 text-gray-700">Dished Head Specification &amp; QC</h2>
                </div>
                <div className="text-right text-sm">
                  <div>Job No: ________________</div>
                  <div>Date: {new Date().toLocaleDateString()}</div>
                  <div className="text-xs text-gray-400 mt-1">v{APP_VERSION}</div>
                </div>
              </div>

              <div className="grid grid-cols-2 gap-8 mb-6">
                <div>
                  <h3 className="font-bold text-lg border-b border-gray-400 mb-2">Design Data</h3>
                  <table className="w-full text-sm">
                    <tbody>
                      <tr className="border-b border-gray-100">
                        <td className="py-1 text-gray-600">Standard</td>
                        <td className="py-1 font-medium text-right">{config.standard}</td>
                      </tr>
                      <tr className="border-b border-gray-100">
                        <td className="py-1 text-gray-600">Material</td>
                        <td className="py-1 font-medium text-right">{config.material}</td>
                      </tr>
                      <tr className="border-b border-gray-100">
                        <td className="py-1 text-gray-600">Edge Prep</td>
                        <td className="py-1 font-medium text-right">
                          {config.edgePrep === 'None' ? 'Square Cut' : `${config.edgePrep} ${config.bevelAngle}u`}
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <div>
                  <h3 className="font-bold text-lg border-b border-gray-400 mb-2">Dimensions (Nominal)</h3>
                  <table className="w-full text-sm">
                    <tbody>
                      <tr className="border-b border-gray-100">
                        <td className="py-1 text-gray-600">Da (Outer Dia)</td>
                        <td className="py-1 font-medium text-right">{config.diameterOuter} mm</td>
                      </tr>
                      <tr className="border-b border-gray-100">
                        <td className="py-1 text-gray-600">s (Thickness)</td>
                        <td className="py-1 font-medium text-right">{config.thickness} mm</td>
                      </tr>
                      <tr className="border-b border-gray-100">
                        <td className="py-1 text-gray-600">H (Total Height)</td>
                        <td className="py-1 font-medium text-right">{calculated.totalHeight.toFixed(1)} mm</td>
                      </tr>
                      <tr className="border-b border-gray-100">
                        <td className="py-1 text-gray-600">Est. Weight</td>
                        <td className="py-1 font-medium text-right">{calculated.weight.toFixed(1)} kg</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <div className="mb-6 border border-gray-300 rounded p-4 flex justify-center h-80">
                <svg viewBox={printViewBox} className="h-full w-auto">
                  <line
                    x1={center}
                    y1={printMinY}
                    x2={center}
                    y2={printMinY + printHeight}
                    stroke="#ccc"
                    strokeDasharray="5,5"
                  />
                  <line
                    x1={printMinX}
                    y1={center}
                    x2={printMinX + printWidth}
                    y2={center}
                    stroke="#ccc"
                    strokeDasharray="5,5"
                  />
                  {drawHeadProfile(true)}
                  {nozzles.map((n) => {
                    const nW = parseInt(n.size.replace('DN', ''), 10) || 50;
                    const nVisualW = Math.max(20, nW);
                    const nH = 60;
                    const nX = center + n.offset;
                    const nY = center - calculated.totalHeight / 2 + config.thickness + 10;
                    return (
                      <rect
                        key={n.id}
                        x={nX - nVisualW / 2}
                        y={nY - nH}
                        width={nVisualW}
                        height={nH}
                        fill="none"
                        stroke="black"
                        strokeWidth={Math.max(1, config.diameterOuter / 1000)}
                      />
                    );
                  })}
                </svg>
              </div>

              <div className="mb-8">
                <h3 className="font-bold text-lg border-b-2 border-black mb-3 pb-1 bg-gray-50 px-2">
                  Quality Control / Measurement Report
                </h3>
                <p className="text-xs text-gray-500 mb-2 italic">
                  Tolerances based on DIN 28005-1 (Formed Heads). All dimensions in mm.
                </p>

                <table className="w-full text-sm border-collapse border border-gray-300">
                  <thead className="bg-gray-100">
                    <tr>
                      <th className="border border-gray-300 p-2 text-left w-1/4">Parameter</th>
                      <th className="border border-gray-300 p-2 text-center w-1/6">Nominal</th>
                      <th className="border border-gray-300 p-2 text-center w-1/6">Tolerance</th>
                      <th className="border border-gray-300 p-2 text-center w-1/6">Actual 1</th>
                      <th className="border border-gray-300 p-2 text-center w-1/6">Actual 2</th>
                      <th className="border border-gray-300 p-2 text-center w-1/6">Result / Dev</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td className="border border-gray-300 p-2 font-medium">
                        Outer Diameter (Da) <br />
                        <span className="text-xs font-normal text-gray-500">Measure at 0u / 90u</span>
                      </td>
                      <td className="border border-gray-300 p-2 text-center">{config.diameterOuter}</td>
                      <td className="border border-gray-300 p-2 text-center">
                        +{calculated.tolerances.daPlus} / -{calculated.tolerances.daMinus}
                      </td>
                      <td className="border border-gray-300 p-2"></td>
                      <td className="border border-gray-300 p-2"></td>
                      <td className="border border-gray-300 p-2 bg-gray-50"></td>
                    </tr>

                    <tr>
                      <td className="border border-gray-300 p-2 font-medium">
                        Ovality (u) <br />
                        <span className="text-xs font-normal text-gray-500">Max diff (Dmax - Dmin)</span>
                      </td>
                      <td className="border border-gray-300 p-2 text-center">0</td>
                      <td className="border border-gray-300 p-2 text-center">Max {calculated.tolerances.ovality}</td>
                      <td className="border border-gray-300 p-2 bg-gray-100 text-center text-xs text-gray-400" colSpan={2}>
                        - Calculated -
                      </td>
                      <td className="border border-gray-300 p-2"></td>
                    </tr>

                    <tr>
                      <td className="border border-gray-300 p-2 font-medium">Total Height (H)</td>
                      <td className="border border-gray-300 p-2 text-center">{calculated.totalHeight.toFixed(1)}</td>
                      <td className="border border-gray-300 p-2 text-center">
                        +{calculated.tolerances.hPlus} / -{calculated.tolerances.hMinus}
                      </td>
                      <td className="border border-gray-300 p-2"></td>
                      <td className="border border-gray-300 p-2 bg-gray-100"></td>
                      <td className="border border-gray-300 p-2"></td>
                    </tr>

                    <tr>
                      <td className="border border-gray-300 p-2 font-medium">
                        Wall Thickness (s) <br />
                        <span className="text-xs font-normal text-gray-500">Min. after forming</span>
                      </td>
                      <td className="border border-gray-300 p-2 text-center">{config.thickness}</td>
                      <td className="border border-gray-300 p-2 text-center">
                        Min {config.thickness - calculated.tolerances.thicknessMin}
                      </td>
                      <td className="border border-gray-300 p-2"></td>
                      <td className="border border-gray-300 p-2"></td>
                      <td className="border border-gray-300 p-2"></td>
                    </tr>

                    <tr>
                      <td className="border border-gray-300 p-2 font-medium">
                        Edge Preparation <br />
                        <span className="text-xs font-normal text-gray-500">{config.edgePrep} check</span>
                      </td>
                      <td className="border border-gray-300 p-2 text-center">-</td>
                      <td className="border border-gray-300 p-2 text-center">Visual</td>
                      <td className="border border-gray-300 p-2 text-center text-xs text-gray-400" colSpan={2}>
                        Pass / Fail
                      </td>
                      <td className="border border-gray-300 p-2"></td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div className="grid grid-cols-2 gap-12 mt-auto">
                <div>
                  <div className="h-12 border-b border-black"></div>
                  <div className="text-xs mt-1">QC Inspector (Name &amp; Sign)</div>
                </div>
                <div>
                  <div className="h-12 border-b border-black"></div>
                  <div className="text-xs mt-1">Date</div>
                </div>
              </div>
            </div>
          </div>
        </>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<PressureVesselDishedEndCalc />);
  </script>
</body>

</html>
